class CrossBrowserTestCase < ActionDispatch::SystemTestCase

  def self.browsers
    [
      [:headless_chrome, [1400, 1400]], # desktop
      [:headless_firefox, [1400, 1400]],
      [:headless_chrome, [414, 736]], # iPhone 6/7/8
      [:headless_firefox, [414, 736]],
      [:headless_chrome, [360, 640]], # galaxy s5
      [:headless_firefox, [360, 640]]
    ]
  end

  def self.info(driver, screen_size)
    return "on #{driver} #{screen_size[0]}x#{screen_size[0]}"
  end

  def self.cross_browser_test(str, &block)
    browsers.each do | d, s |
      driven_by :selenium, using: d, screen_size: s
      test("#{info(d,s)} #{str}") do
        instance_eval(&block) # here we go. wheeeee!
      end
    end
  end

end
