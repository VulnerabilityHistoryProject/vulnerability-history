require "test_helper"
require 'json-schema'

class VulnerabilitiesApiTest < ActionDispatch::IntegrationTest

  # The main purpose of this is to just test that the API is working.

  test "/api/vulnerabilities has the word 'attacker' somewhere" do
    get "/api/vulnerabilities"
    assert_response :success
    assert @response.body.include? 'attacker' # everything working?
    # body_json = JSON.parse(@response.body)
    # puts File.read('public/openapi.yml')
    api_yml = YAML.load(File.read('public/openapi.yml'))
    schema = api_yml.dig('paths','/api/vulnerabilities','get','responses',
                         '200','content','application/json','schema')
    JSON::Validator.validate!(schema, @response.body, json: true )
  end

end
