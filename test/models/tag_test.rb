require 'test_helper'

class TagTest < ActiveSupport::TestCase
  test 'overlaps' do

    #call overlaps method with set of shortnames that returns a set of tags
    results = Tag.overlaps(['cooks', 'owners', 'refactors', 'reverts'],10, 0)
    expected = %w(
      CVE-2013-2878
      CVE-2016-1676
      CVE-2011-3093
      CVE-2011-5904
    )
    assert_equal expected, results.map { |tag| tag['cve']}, 'Tag overlap expected not working'
  end

  test 'tag_trends' do
    #call tag_trends method with set of families that returns a set of nodes and links
    tagTrendsResults = Tag.tag_trends(['bounty', 'lifetime', 'project', 'language'])
    tagTrendsNodesResults = tagTrendsResults[:nodes].map { |node| node[:name]}
    #binding.irb
    #validate sql statement used to generate results
    expected_results = %w(
      project-xx
      bounty
      language-d
      lifetime-10
    )
    assert_equal expected_results, tagTrendsNodesResults, 'SQL statement is not correct'
  end
end
