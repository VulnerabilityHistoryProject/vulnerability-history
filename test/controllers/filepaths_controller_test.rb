require 'test_helper'

class FilepathsControllerTest < ActionDispatch::IntegrationTest
  # Andy deleted the auto-generated tests. Go look into Git history get them
  # back when we decide to write these tests.
  test 'Checks basic route functionality' do
    assert_generates '/filepaths', controller: 'filepaths', action: 'index'
    assert_routing '/filepaths', controller: 'filepaths', action: 'index'
    assert_recognizes({controller: 'filepaths', action: 'index'}, 'filepaths')
  end

  test 'Checks show functionality' do
    path = 'chrome/common/gfx/url_elider.cc'
    assert_generates "/filepaths/Chromium/#{path}", controller: 'filepaths', action: 'show', project: 'Chromium', path: "#{path}"
    assert_routing "/filepaths/Chromium/#{path}", controller: 'filepaths', action: 'show', project: 'Chromium', path: "#{path}"
    assert_recognizes({controller: 'filepaths', action: 'show', project: 'Chromium', path: "#{path}"}, "/filepaths/Chromium/#{path}")
  end

  test 'Allow routes with hyphens' do
    path = 'third_party/WebKit/Source/platform/image-decoders/gif/GIFImageReader.cpp'
    assert_generates "/filepaths/Chromium/#{path}", controller: 'filepaths', action: 'show', project: 'Chromium', path: "#{path}"
    assert_routing "/filepaths/Chromium/#{path}", controller: 'filepaths', action: 'show', project: 'Chromium', path: "#{path}"
    assert_recognizes({controller: 'filepaths', action: 'show', project: 'Chromium', path: "#{path}"}, "/filepaths/Chromium/#{path}")
  end

  test 'Bad ID redirects' do
    get '/filepaths/12345'
    assert_redirected_to "/filepaths"
  end

  test 'Bad filepath redirects' do
    get '/filepaths/Chromium/some/file/that/does/not/exist.extension'
    assert_redirected_to "/filepaths"
  end

  test 'Bad project redirects' do
    get '/filepaths/Flowmium/DEPS'
    assert_redirected_to "/filepaths"
  end

end
