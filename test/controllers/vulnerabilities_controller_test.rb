require 'test_helper'
require 'loaders/vulnerability_loader'

class VulnerabilitiesControllerTest < ActionDispatch::IntegrationTest

  test 'generate from routes' do
    assert_routing '/vulnerabilities',
      controller: 'vulnerabilities',
      action: 'index'
  end

  test 'basic vuln route works' do
    assert_routing "/vulnerabilities/CVE-2011-3092",
      controller: "vulnerabilities",
      action: "show",
      id: 'CVE-2011-3092'
  end

  test 'bad vuln route raises error' do
    assert_raise(ActionController::RoutingError) do
      get "/vulnerabilities/abc"
    end
  end

  test 'just CVE in the URL' do
    expected = {
      controller: 'vulnerabilities',
      action: 'show',
      id: 'CVE-2011-3092'
    }
    assert_recognizes expected, "/CVE-2011-3092"
  end

end
