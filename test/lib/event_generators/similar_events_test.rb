require 'test_helper'
require 'event_generators/similar_events'

class SimilarEventsTest < ActiveSupport::TestCase

  test 'similar events created for vulns' do
    SimilarEvents.new.generate
    expected = [
      "Similar vulnerability: CVE-2011-3092 is also in this/is/a/test",
      "Similar vulnerability: CVE-2013-2878 has the same CWE 119",
      "Similar vulnerability: CVE-2016-1676 has the same CWE 119",
      "Similar vulnerability: CVE-2016-1676 is also in this/is/a/test"
    ]

    actual = Event.where("description_template LIKE '%Similar vulnerability:%'").
                   map{ |e| e.description }.sort

    assert_equal expected, actual

  end

end
