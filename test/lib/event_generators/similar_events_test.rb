require 'test_helper'
require 'event_generators/similar_events'
require 'writing'

class SimilarEventsTest < ActiveSupport::TestCase

  test 'similar events created for vulns' do
    p = projects(:one)
    SimilarEvents.new(p).generate
    expected = [
      "Similar vulnerability: CVE-2011-3092 is also in this/is/a/test",
      "Similar vulnerability: CVE-2013-2878 has the same CWE",
      "Similar vulnerability: CVE-2016-1676 has the same CWE",
      "Similar vulnerability: CVE-2016-1676 is also in this/is/a/test"
    ]
    actual = Event.where("description LIKE '%Similar vulnerability:%'").
                   map{ |e| e.description }.sort
    assert_equal expected, actual
  end

end
