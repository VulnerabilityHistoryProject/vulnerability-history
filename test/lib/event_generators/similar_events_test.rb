require 'test_helper'
require 'event_generators/similar_events'

class SimilarEventsTest < ActiveSupport::TestCase

  test 'similar events created for vulns' do
    SimilarEvents.new.generate
    expected = [
      "Similar vulnerability: CVE-2011-3092 is in same directory",
      "Similar vulnerability: CVE-2013-2878 has same CWE",
      "Similar vulnerability: CVE-2016-1676 has same CWE",
      "Similar vulnerability: CVE-2016-1676 is in same directory"
    ]

    actual = Event.where(detail_type: 'Vulnerability').
                   where("title_template LIKE '%Similar vulnerability:%'").
                   map{ |e| e.title }.sort

    assert_equal expected, actual

  end

end
