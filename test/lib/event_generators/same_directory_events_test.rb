require 'test_helper'
require 'event_generators/same_directory_events'
require 'writing'

class SameDirectoryEventsTest < ActiveSupport::TestCase

  setup do
    @silent_logger = TimingLogger.new(StringIO.new, '')
  end

  test 'same directory generated properly' do
    expected = [
        "Nearby vulnerability in /",
        "Nearby vulnerability in /",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in cc/",
        "Nearby vulnerability in this/is/a/test/",
        "Nearby vulnerability in this/is/a/test/",
        "Nearby vulnerability in this/is/a/test/",
        "Nearby vulnerability in this/is/a/test/",
        "Nearby vulnerability in this/is/a/test/",
        "Nearby vulnerability in this/is/a/test/",
        "Nearby vulnerability in this/is/a/test/",
        "Nearby vulnerability in this/is/a/test/",
        "Nearby vulnerability in webkit/port/",
        "Nearby vulnerability in webkit/port/",
    ]
    SameDirectoryEvents.new(@silent_logger).generate()
    actual = Event.where("title LIKE 'Nearby %'")
                  .pluck(:title).sort
    assert_equal expected, actual
  end
end
