require 'test_helper'
require_all 'lib/event_generators/*.rb'

class AllLulnerabilityEventsTest < ActiveSupport::TestCase

  setup do
    VulnerabilityEvents.new.generate
    FixEvents.new.generate
    VccEvents.new.generate
    ReleaseEvents.new.generate
    InterestingCommitEvents.new.generate
    CommitEvents.new.generate
    BountyEvents.new.generate
  end

  test 'get all vulnerability events' do
    v = Vulnerability.find_by(cve: 'CVE-2011-3092')
    expected = [
      "Bounty awarded for CVE-2011-3092",
      'Edit: Search box support, Chromium side.BUG=9210',
      'Fix: Strip CRs from *.in files to allow building from webkit.org',
      'Release 17',
      'Release 19',
      'Vulnerability Announced for CVE-2011-3092',
      "Vulnerability-contributing commit: Remove empty unused directories from src/webkit.",
      "Vulnerability-contributing commit: WebKit merge 39606:39660 Review URL: http://codereview.chromium.org/17239",
    ]
    actual = v.events.map { |e| e.title.to_s }.sort
    assert_equal expected, actual
  end

end
