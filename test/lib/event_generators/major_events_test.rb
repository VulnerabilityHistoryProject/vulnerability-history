require 'test_helper'
require 'event_generators/major_events'

class MajorEventsTest < ActiveSupport::TestCase

  test 'major events created for all vulns' do
    MajorEvents.new.generate
    expected = [
      "Major Event: Revision 149280, absolutify paths to /svg.",
      "Major Event: Revision 150643, removed over 100 extraneous include statements."
    ]

    actual = Event.where(detail_type: 'Vulnerability').
                   where("title_template LIKE '%Major Event%'").
                   map { |e| e.title }.sort
    assert_equal expected, actual
  end

end
