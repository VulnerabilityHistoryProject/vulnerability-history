require 'test_helper'
require 'event_generators/commit_events'

class CommitEventsTest < ActiveSupport::TestCase

  test 'commit events created for all vulns' do
    event_count = Event.count
    CommitEvents.new.generate
    expected = [
      "Edit: Remove empty unused directories from src/webkit.",
      "Edit: Search box support, Chromium side.BUG=9210",
      "Edit: Search box support, Chromium side.BUG=9210",
      "Edit: SimplifiedBackwardsTextIterator returns incorrect offset with first-letter rule",
      "Edit: Strip CRs from *.in files to allow building from webkit.org",
      "Edit: Use the V8Bindings for HTMLSelectElementCollection and HTMLOptionsCollection in svn.webkit.org.",
      "Edit: Use the V8Bindings for HTMLSelectElementCollection and HTMLOptionsCollection in svn.webkit.org.",
      "Edit: WebKit merge 39606:39660 Review URL: http://codereview.chromium.org/17239"
    ]
    actual = Event.where(detail_type: 'Commit').
                   where("title_template LIKE 'Edit: %'").
                   map { |e| e.title }.sort
    assert_equal expected, actual
  end

end
