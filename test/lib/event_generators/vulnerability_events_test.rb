require 'test_helper'
require 'event_generators/vulnerability_events'

class VulnerabilityEventsTest < ActiveSupport::TestCase

  test 'vuln events created for all vulns' do
    event_count = Event.count
    VulnerabilityEvents.new.generate
    expected = [
      # dup because we already have one in fixtures
      "Edit: CVE-2011-3092", 
      "Edit: CVE-2013-2878"
    ]
    actual = Event.where(detail_type: 'Vulnerability').
                   where("title_template LIKE 'Edit: %'").
                   map { |e| e.title }.sort
    assert_equal expected, actual
  end

end
