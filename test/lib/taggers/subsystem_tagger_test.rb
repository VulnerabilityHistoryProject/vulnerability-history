require 'test_helper'
require 'writing'
require 'taggers/subsystem_tagger'

class SubsystemTaggerTest < ActiveSupport::TestCase

  setup do
    t = SubsystemTagger.new(projects(:one))
    t.create_tags
    t.apply_tags
  end

  test 'subsystem single tag applied' do
    tags = vulnerabilities(:cve_2013_2878).tags.pluck(:shortname)
    assert(tags.include?('subsystem-httpd-examplesub'))
  end

  test 'multiple tags applied' do
    tags = vulnerabilities(:cve_2016_1676).tags.pluck(:shortname)
    assert(tags.include?('subsystem-httpd-sub1'))
    assert(tags.include?('subsystem-httpd-sub2'))
  end

  test 'no subsystem tags' do
    cve_2011_3092 = vulnerabilities(:cve_2011_3092) # nothing
    result = cve_2011_3092.tags.pluck(:shortname).none?(/subsystem/)
    assert(result)

    cve_2011_3093 = vulnerabilities(:cve_2011_3093) # not even subsystem
    result = cve_2011_3093.tags.pluck(:shortname).none?(/subsystem/)
    assert(result)
  end


end