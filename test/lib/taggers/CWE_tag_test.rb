require 'test_helper'
require 'taggers/cwe_tagger'

class CWETagTest < ActiveSupport::TestCase

  test 'cwe tags created' do
    t = CWETagger.new
    t.create_tags
    tags = Tag.all.pluck(:shortname)
    assert(tags.include?('cwe-110'), "cwe-110 exists")
    assert(tags.include?('cwe-119'), "cwe-119 exists")
    assert(tags.include?('cwe-14'), "cwe-14 exists")
  end

  test 'cwe tags applied' do
    t = CWETagger.new
    t.create_tags
    t.apply_tags

    tags = vulnerabilities(:cve_2011_3092).tags.pluck(:shortname)
    assert(tags.include?('cwe-110'), "CVE-2011-3092 has 110, multiple tags")
    assert(tags.include?('cwe-14'), "CVE-2011-3092 has 14, multiple tags")

    tags = vulnerabilities(:cve_2013_2878).tags.pluck(:shortname)
    assert(tags.include?('cwe-119'), "CVE-2013-2878 has 110, parsing string")

    tags = vulnerabilities(:cve_2016_1676).tags.pluck(:shortname)
    assert(tags.include?('cwe-119'), "CVE-2016-1676 has 110, normal")
  end
end