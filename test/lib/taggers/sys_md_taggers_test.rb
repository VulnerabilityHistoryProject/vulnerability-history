require 'test_helper'
require 'writing'
require 'taggers/auto_discoverable_tagger'
require 'taggers/specification_tagger'
require 'taggers/sandbox_tagger'
require 'taggers/discussion_tagger'
require 'taggers/vouch_tagger'
require 'taggers/stack_trace_tagger'
require 'taggers/forgotten_check_tagger'

class SysMdTaggersTest < ActiveSupport::TestCase

  test 'autodiscoverable tags' do
    t = AutoDiscoverableTagger.new
    t.create_tags
    t.apply_tags
    tag = Tag.find_by(shortname: 'not-autodiscoverable')
    assert(tag)
    vt = VulnerabilityTag.find_by(tag_id: tag.id)
    assert(vt)
  end

  test 'specification tags' do
    t = SpecificationTagger.new
    t.create_tags
    t.apply_tags
    tag = Tag.find_by(shortname: 'specification')
    assert(tag)
    vt = VulnerabilityTag.find_by(tag_id: tag.id)
    assert(vt)
  end

  test 'sandbox tags' do
    t = SandBoxTagger.new
    t.create_tags
    t.apply_tags
    tag = Tag.find_by(shortname: 'sandbox')
    assert(tag)
    vt = VulnerabilityTag.find_by(tag_id: tag.id)
    assert(vt)
  end

  test 'security discussion tags' do
    t = DiscussionTagger.new
    t.create_tags
    t.apply_tags
    tag = Tag.find_by(shortname: 'discussion-security')
    assert(tag)
    vt = VulnerabilityTag.find_by(tag_id: tag.id)
    assert(vt)
  end

  test 'any discussion tags' do
    t = DiscussionTagger.new
    t.create_tags
    t.apply_tags
    tag = Tag.find_by(shortname: 'discussion-any')
    assert(tag)
    vt = VulnerabilityTag.find_by(tag_id: tag.id)
    assert(vt)
  end

  test 'vouch tags' do
    t = VouchTagger.new
    t.create_tags
    t.apply_tags
    tag = Tag.find_by(shortname: 'vouch')
    assert(tag)
    vt = VulnerabilityTag.find_by(tag_id: tag.id)
    assert(vt)
  end

  test 'any stacktrace tags' do
    t = StackTraceTagger.new
    t.create_tags
    t.apply_tags
    tag = Tag.find_by(shortname: 'stack-any')
    assert(tag)
    vt = VulnerabilityTag.find_by(tag_id: tag.id)
    assert(vt)
  end

  test 'fix stacktrace tags' do
    t = StackTraceTagger.new
    t.create_tags
    t.apply_tags
    tag = Tag.find_by(shortname: 'stack-fix')
    assert(tag)
    vt = VulnerabilityTag.find_by(tag_id: tag.id)
    assert(vt)
  end

  test 'forgotten check tags' do
    t = ForgottenCheckTagger.new
    t.create_tags
    t.apply_tags
    tag = Tag.find_by(shortname: 'forgot-check')
    assert(tag)
    vt = VulnerabilityTag.find_by(tag_id: tag.id)
    assert(vt)
  end

end