require "application_system_test_case"

class ContentTest < ApplicationSystemTestCase
  setup do
    Capybara.app_host = "https://alpha.vulnerabilityhistory.org"
    Capybara.run_server = false

    @start = tags_path
  end

  test 'Page title and tag descriptions' do
    visit @start
    gc = find('.grid-container')

    exp_title = 'Tags'
    exp_description = 'Tags are one of the main ways we use organize vulnerabilities in VHP. '\
    'Tags can be gathered automatically, or manually, or with a combination '\
    'of both. Here are a few different types of tags below.'
    exp_lesson_desc = 'Lesson tags are about broader lessons that can be '\
    'learned from that vulnerability. These are security principles '\
    'and engineering pitfalls that we believe should be taught to all software engineers.'
    exp_discovered_desc = 'Discovered tags are about how the vulnerability was originally found.'
    exp_lifetime_desc = 'Lifetime tags indicate how long we believe the vulnerability remained in the system.'
    exp_cwe_desc = 'CWE, or Common Weakness Enumeration, tags are '\
    'manually assigned by curators to describe the particular type of vulnerability.'
    exp_subsystem_desc = "Subsystem tags are the curators' best efforts at "\
    'determining what part of the system this vulnerability affected.'
    exp_project_desc = 'Project tags are the case study the vulnerability is from.'
    exp_language_desc = 'Language tags are what type of source code was fixed.'
    exp_severity_desc = "Severity tags are based on the NVD's CVSS."

    title = gc.all('.grid-x')[0].text

    descriptions_wrapper = gc.all('.grid-x')[1].all('p')

    assert_equal exp_title, title
    assert_equal exp_description, descriptions_wrapper[0].text
    assert_equal exp_lesson_desc, descriptions_wrapper[1].text
    assert_equal exp_discovered_desc, descriptions_wrapper[2].text
    assert_equal exp_lifetime_desc, descriptions_wrapper[3].text
    assert_equal exp_cwe_desc, descriptions_wrapper[4].text
    assert_equal exp_subsystem_desc, descriptions_wrapper[5].text
    assert_equal exp_project_desc, descriptions_wrapper[6].text
    assert_equal exp_language_desc, descriptions_wrapper[7].text
    assert_equal exp_severity_desc, descriptions_wrapper[8].text
  end
end