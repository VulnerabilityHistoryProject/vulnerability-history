require 'test_helper'
require 'selenium-webdriver'

class Header_Footer < ActiveSupport::TestCase
    test 'header_footer' do
        begin
            driver = Selenium::WebDriver.for :chrome

            driver.navigate.to 'http://localhost:3000/'

            # refresh works fine
            url = driver.current_url
            driver.navigate.refresh
            assert_equal(url, driver.current_url)

            # title is what it should be
            assert_equal(driver.title, 'The Vulnerability History Project')


            # header appears how it should
            header = driver.find_element(class: 'top-bar')
            assert_not_nil(header)

            title = header.find_element(class: 'top-bar-left')
            icon = title.find_element(tag_name: 'img')
            assert_not_nil(icon)    # if i find out how to make sure the image is the logo i'll be sure to change this check
            title_text = title.find_element(tag_name: 'a').text
            assert_equal(title_text, 'The Vulnerability History Project')

            navbar = header.find_element(class: 'top-bar-right').find_element(tag_name: 'ul')
            links = navbar.find_elements(tag_name: 'li')
            count = 1
            links.each { |e| 
                if e.attribute('class').include? 'right'
                    link = e.find_element(tag_name: 'a')
                    case count
                    when 1
                        assert_equal(link.text, 'Vulnerabilities')
                    when 2
                        assert_equal(link.text, 'Code')
                    when 3
                        assert_equal(link.text, 'Articles')
                    end
                elsif e.attribute('class').include? 'has-submenu'
                    submenu_title = e.find_element(tag_name: 'a')
                    case count
                    when 4
                        assert_equal(submenu_title.text, 'Tags')
                    when 5
                        assert_equal(submenu_title.text, 'More')
                    end
                    submenu = e.find_element(class: 'submenu')
                    submenu_items = submenu.find_elements(tag_name: 'li')
                    subcount = 1
                    submenu_items.each { |item|
                        sublink = item.find_element(tag_name: 'a').attribute('text')    # not really sure why .text doesn't work, but it doesn't at this time
                        case count
                        when 4
                            case subcount
                            when 1
                                assert_equal(sublink, 'All')
                            when 2
                                assert_equal(sublink, 'Projects')
                            when 3
                                assert_equal(sublink, 'CWEs')
                            when 4
                                assert_equal(sublink, 'Languages')
                            when 5
                                assert_equal(sublink, 'Lessons')
                            when 6
                                assert_equal(sublink, 'Severities')
                            when 7
                                assert_equal(sublink, 'Subsystems')
                            end
                        when 5
                            case subcount
                            when 1
                                assert_equal(sublink, 'Case Studies')
                            when 2
                                assert_equal(sublink, 'How to Curate')
                            when 3
                                assert_equal(sublink, 'By the Numbers')
                            when 4
                                assert_equal(sublink, 'About Us')
                            end
                        end
                        subcount += 1
                    }
                end
                count += 1
            }


            # footer appears how it should
            footer = driver.find_element(class: 'footer')
            assert_not_nil(footer)

            links_list = footer.find_element(class: 'footer-links')
            links = links_list.find_elements(tag_name: 'li')
            count = 1
            links.each{ |e|
                link = e.find_element(tag_name: 'a')
                case count
                when 1
                    assert_equal(link.text, 'About Us')
                when 2
                    assert_equal(link.text, 'Contact')
                when 3
                    assert_equal(link.text, 'Licensing')
                when 4
                    assert_equal(link.text, 'Github')
                when 5
                    assert_equal(link.text, 'File a Bug')
                when 6
                    assert_equal(link.text, 'Cite')
                end
                count += 1
            }


        ensure
            driver.quit
        end
    end
end