require "application_system_test_case"

class ContentTest < ApplicationSystemTestCase
  setup do
    Capybara.app_host = "https://alpha.vulnerabilityhistory.org"
    Capybara.run_server = false

    @home = '/'
    Rails.cache.clear
  end

  test 'look for "The Vulnerability History Project"' do
    visit @home
    gc = find('.grid-container').text

    assert gc.include? 'The Vulnerability History Project'
  end

  test 'look for "A museum of mistakes"' do
    visit @home
    gc = find('.grid-container').text

    assert gc.include? 'A museum of mistakes to help us engineer secure software.'
  end

  test 'a.buttons' do
    visit @home
    gc = find('.grid-container')
    buttons = gc.all('a')
    links = Array.new

    buttons.each { |button|
      links << button[:href]
    }

    links.each { |link|
      visit link
      assert_equal link, current_url
    }
  end

  test 'individual vulnerability' do
    visit '/vulnerabilities'
    cwe = find('tbody').all('tr')[0].all('td')[0].find('a')[:href]
    visit cwe

    gc = find('.grid-container')
    tabs = gc.find('.tabs').text
    assert tabs.include? 'Mistakes Made'
    assert tabs.include? 'Tag Notes'
    assert tabs.include? 'Fix'
    assert tabs.include? 'VCC'
    assert tabs.include? 'Curator Notes'
    assert tabs.include? 'Curate'
  end
end
