require "application_system_test_case"

class ContentTest < ApplicationSystemTestCase
  setup do
    Capybara.app_host = "https://alpha.vulnerabilityhistory.org"
    Capybara.run_server = false

    @tags = '/tags'
    Rails.cache.clear
  end

  test 'page title' do
    visit @tags
    gc = find('.grid-container')
    title = gc.all('.grid-x')[0].text

    assert_equal 'Tags', title
  end

  test 'table filters to 50 results' do
    visit @tags
    gc = find('.grid-container')
    table = gc.find('#datatable')
    table_body = table.find('tbody')

    assert_equal 50, table_body.all('tr').count
  end

  test 'table filters to 10 results' do
    visit @tags
    gc = find('.grid-container')
    table = gc.find('#datatable')
    table_body = table.find('tbody')

    filter = gc.find('.dataTables_length')
    filter.select('10')

    assert_equal 10, table_body.all('tr').count
  end

  test 'individual tag' do
    visit @tags
    visit find('tbody').all('tr')[0].all('td')[0].find('a')[:href]

    gc = find('.grid-container')

    assert gc.text.include? 'Examples'
  end
end