Rails.application.routes.draw do

  root 'welcome#index'

  resources :vulnerabilities, only: [:index, :show], format: false do
    get :card
  end
  resources :developers, only: [:index, :show], format: false
  resources :commits, only: [:index, :show], format: false
  resources :releases, only: [:index, :show], format: false
  resources :tags, only: [:index, :show], format: false
  resources :fixes, only: [:show], format: false
  resources :vccs , only: [:show], format: false
  resources :articles, only: [:show, :index], format: false
  resources :projects, only: [:index], format: false

  resources :filepaths, only: [:index, :show], via: [:get], format: false,
            param: :filepath_id

  get :curate, to: 'curate#index'
  get :about, to: 'about#index'
  get :sitemap, to: 'about#sitemap'
  get :news, to: 'news#index'
  get :status, to: 'status#index'
  get :api, to: 'about#api'
  get :tour, to: 'about#tour'

  resources :cves, param: :name, only: [:index, :show], format: false # here only for legacy - should remove someday in favor of these two below
  get "/:id", to: 'vulnerabilities#show', constraints: { id: /CVE\-\d+\-\d+/ }
  get "/api/:id", to: 'vulnerabilities#show', constraints: { id: /CVE\-\d+\-\d+/ }

  scope :insights do
    get 'tag-trends', to: 'insights#tag_trends'

  end

  scope :api do
    resources :vulnerabilities, only: [:index, :show], :format => false do
      get :events
    end
    get :corpus, to: 'vulnerabilities#corpus'

    resources :cves, only: [:index, :show], :format => false do
    end

    resources :commits, only: [:index, :show], :format => false do
      get :developer
    end
    resources :developers, only: [:index, :show], :format => false do
      get :commits
    end
    resources :releases, only: [:index, :show], :format => false

    resources :filepaths, only: [:index, :show],
              via: [:get], format: false, param: :id do
      get :developers, :commits, :contributors, :vulnerabilities, format: false
    end

    resources :tags, only: [:index, :show], :format => false

    get 'insights/tag-trends', to: 'insights#tag_trends_api'

    resources :articles, only: [:index, :show], :format => false

    resources :projects, only: [:index, :show], :format => false do
      get :releases
      get :fixes
    end

    resources :fixes, only: [:show], :format => false
  end

end
