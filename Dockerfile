# uses the specified ruby version - i'm just going from the version in the germfile, so if that changes, this should change
FROM ruby:2.6

# specifies the bundler version
ENV BUNDLER_VERSION=2.2.6

RUN apt-get update

# downloads newest nodejs repo since debian buster only uses 10.23.1 & we use more updated versions
RUN curl -sL https://deb.nodesource.com/setup_14.x | bash -

# installs some necessary packages
RUN apt-get update && apt-get install -y \
    gcc
    g++
    make
    nodejs

# installs yarn
RUN npm install --global yarn

# installs bundler
RUN gem install bundler -v 2.2.6

# sets the working directory for the app on the container
WORKDIR /app

# copies over the gemfile
COPY ./Gemfile ./Gemfile.lock ./

# installs the project gems
RUN bundle check || bundle install

# copies over the js dependencies
COPY ./package.json ./yarn.lock ./

# installs js packages
RUN yarn install --check-files

# copies the application code
COPY . ./

EXPOSE 3000

# starts the app from this script
ENTRYPOINT ["./entrypoints/docker-entrypoint.sh"]