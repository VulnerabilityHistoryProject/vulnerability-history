import $ from 'jquery'
import { OffenderMap } from './offender_map'
import { OffenderTable } from './offender_table'

$( document ).ready( function() {
  var offenders;
  $.when(
    $.ajax({
        url: "/api/filepaths?offenders=true",
        dataType: 'json'
    }).done(function(data) {
      offenders = data;
    }),
    $.ajax({
        type: "GET",
        dataType: "json",
        url: "/api/projects"
    }).done(function(data) {
      window.projects = {};
      data.forEach(p => {
        $('.project-choice').append(`<option value=${p.id}>${p.name}</option>`);
        window.projects[p.id] = p;
      });
      data.forEach(p => {
        $('.project-choice-table').append(`<option value=${p.id}>${p.name}</option>`);
        window.projects[p.id] = p;
      });
    })
  ).then(function() { // once both ajax calls are done
    $('#loading_map').remove();
    new OffenderMap(offenders).init();
    // building table after map because the page defaults to Map first.
    // We COULD build this in parallel with the map, or prioritize depending on
    // which was chosen: filepaths#map or filepaths#table
    // For now, these are both pretty fast anyway so it's not noticeable.
    new OffenderTable(offenders).init(); // For now, doing in sequence - could change to parallel later
  });
});
