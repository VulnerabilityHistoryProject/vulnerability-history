import $ from 'jquery'
import { buildDevPie } from './dev-pie'
import { keyCommitsTable } from './keyCommitsTable'
import { vulnTable } from '../vulnerabilities/vulnTable'

$( document ).ready( function() {
  $.ajax({
    url: `/api/filepaths/${filepath_slug}/contributors`,
    dataType: 'json'
  }).done(function(jsonData) {
      buildDevPie(jsonData);
  });

  $.when(
    $.ajax({
      url: `/api/filepaths/${filepath_slug}/vulnerabilities`,
      data: { short_descriptions: true },
      dataType: 'json'
    }),
    $.ajax({
      url: `/api/tags?map=true`,
      dataType: "json", 
    })
  ).then(function(vulns_response, tags_response) { // both ajax calls are done
    vulnTable(vulns_response[0], tags_response[0], '#vulndatatable');
  });

  $.ajax({
      url: `/api/filepaths/${filepath_slug}/commits`,
      dataType: 'json'
  }).done(function(jsonData) {
      keyCommitsTable(jsonData, '#edit_table')
  });

});
