class ProgressController < ApplicationController

  # GET /about
  def index
    @projects = Project.all
  end

  # GET /api/about/progress
  def progress
    stats = {}
    Project.all.each do |p|
      p_stats = {}
      num_vulns = Vulnerability.where(project: p).count
      p_stats[:num_vulns] = num_vulns
      p_stats[:num_vulns_report] = ActiveSupport::NumberHelper.number_to_delimited(num_vulns, :delimiter => ',')
      num_curated = Vulnerability.curated.where(project: p).count
      p_stats[:num_curated] = num_curated
      p_stats[:perc_curated] = 100.0 * num_curated / num_vulns.to_f
      p_stats[:perc_report] = "%.1f%%" % p_stats[:perc_curated]
      num_w_fixes = Fix.select(:vulnerability_id).distinct.count
      p_stats[:perc_fixes] = (100.0 * num_w_fixes / num_vulns.to_f)
      # @fix_report = "%.1f%%" % @perc_fixes
      # @num_vccs = Vcc.count
      # @num_w_vccs = Vcc.select(:vulnerability_id).distinct.count
      # @perc_vccs = (100.0 * @num_w_vccs / num_vulns.to_f)
      # @vcc_report = "%.1f%%" % @perc_vccs
      stats[p.id] = p_stats
    end
    stats[0] = all_project_stats()
    render_json_for_api stats
  end

  private

  def all_project_stats
    {
      num_vulns: Vulnerability.count
    }
  end


end
