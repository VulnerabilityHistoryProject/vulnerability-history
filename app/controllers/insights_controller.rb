class InsightsController < ApplicationController
  before_action :permit_params

	# GET /insights/correlogram
  def correlogram

  end

	# GET /api/insights/tag-correlations
	def tag_correlations
		if params_valid?
			render_json_for_api Tag.correlogram(params[:x], params[:y])
		else
			err_bad_params!
		end
	end

  private

		def err_bad_params!
			flash[:error] = 'Bad parameters provided to API call. See specification below.'
			redirect_to controller: 'about', action: 'api'
		end

		def params_valid?
			return true unless api_call?
			valid_tag_types = %w(
				cwe
				dependency
				discovered
				discussion
				feature
				fix
				language
				lesson
				lifetime
				location
				mistake
				project
				severity
				stacktrace
				subsystem
				vcc
			)
			return valid_tag_types.include?(params[:x].to_s) &&
						 valid_tag_types.include?(params[:y].to_s)
		end

    def permit_params
			begin
				params.permit([:x, :y])
			rescue
				err_bad_params!
			end
    end
end
