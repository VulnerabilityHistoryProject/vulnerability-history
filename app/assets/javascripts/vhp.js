/* eslint no-console:0 */
// This file is automatically compiled by Webpack, along with any other files
// present in this directory. You're encouraged to place your actual application logic in
// a relevant structure within app/javascript and only use these pack files to reference
// that code so it'll be compiled.
//
// To reference this file, add <%= javascript_pack_tag 'application' %> to the appropriate
// layout file, like app/views/layouts/application.html.erb

// Uncomment to copy all static images under ../images to the output folder and reference
// them with the image_pack_tag helper in views (e.g <%= image_pack_tag 'rails.png' %>)
// or the `imagePath` JavaScript helper below.
//
// const images = require.context('../assets/images', true)
// const imagePath = (name) => images(name, true)

// import 'core-js/stable'
// import $ from 'jquery'
import $ from "jquery";
import "regenerator-runtime/runtime";
import "@fortawesome/fontawesome-free";
import { vhpMarkdownAll } from "./global/vhpMarkdown";
import bindScrollToTopEvents from "./global/scrolltotop";
import { Foundation, Tooltip, OffCanvas } from "foundation-sites";
import routeToVHPView from "./routes";

$(function () {
  Foundation.plugin(Tooltip, "Tooltip");
  $(document).foundation();
  bindScrollToTopEvents();
  vhpMarkdownAll();
  routeToVHPView();

  // Get Mode Switch
  const btns = document.querySelectorAll("#themeToggle, #themeToggle2");
  const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");
  const currentTheme = localStorage.getItem("theme");
  if (prefersDarkScheme.matches) {
    // ...let's toggle the .dark-mode class on the body
    document.body.classList.toggle("dark-mode");
    btns.forEach((btn) => (btn.checked = true));
    // Otherwise, if the user's preference in localStorage is light...
  } else {
    // ...let's toggle the .light-mode class on the body
    document.body.classList.toggle("light-mode");
    btns.forEach((btn) => (btn.checked = false));
  }
  btns.forEach((btn) => {
    btn.addEventListener("click", function () {
      if (currentTheme == "light") {
        document.body.classList.toggle("light-mode");
        document.body.classList.toggle("dark-mode");
        var theme = document.body.classList.contains("light-mode")
          ? "light"
          : "dark";
      } else {
        document.body.classList.toggle("dark-mode");
        document.body.classList.toggle("light-mode");
        var theme = document.body.classList.contains("dark-mode")
          ? "dark"
          : "light";
      }
      // Finally, let's save the current preference to localStorage to keep using it
      localStorage.setItem("theme", theme);
    });
  });
});
