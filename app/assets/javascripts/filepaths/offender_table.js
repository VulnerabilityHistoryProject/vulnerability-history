$( document ).ready( function() {
    $.ajax({
        url: "/api/filepaths?offenders=true",
        dataType: 'json',
        success: function(jsonData) {
            $('#datatable').dataTable({
                responsive: true,
                destroy: true,
                data: jsonData,
                order: [[2, "desc"]], /* Default sort */
                columnDefs: [],
                columns:  [
                    {
                        title: 'File path',
                        data: 'filepath',
                        defaultContent: '',
                        className: 'filepath',
                        responsivePriority: 1,
                        render: (data, type, row) => renderAsLink(data, row)
                    },
                    {
                        title: 'Fixes',
                        data: 'num_fixes',
                        defaultContent: '',
                        responsivePriority: 2,
                        render: (data, type, row) => renderAsLink(data, row)
                    },
                    {
                        title: 'CVEs',
                        data: 'num_cves',
                        defaultContent: '',
                        responsivePriority: 3,
                        render: (data, type, row) => renderAsLink(data, row)
                    },
                    {
                        title: 'CVEs',
                        data: 'cves',
                        defaultContent: '',
                        responsivePriority: 4,
                        render: (data, type, row) => renderAsLink(data, row)
                    }
                ],
                initComplete: function () {
                    $('#loading').remove();
                  }
            });
        }
    });

    $('#datatable').on('mouseover', 'tbody tr', function() {
        $(this).css({
           'cursor': 'pointer',
            'color': 'blue'
        });
    })

    $('#datatable').on('mouseout', 'tbody tr', function() {
        $(this).css({
            'cursor': 'default',
            'color': 'inherit'
        });
    })
});

function renderAsLink(data, row) {
    return '<a class="dt_row" href="/filepaths/' + row.id + '">' + data + '</a>';
}
