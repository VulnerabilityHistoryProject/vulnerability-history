import $ from 'jquery'
import * as d3 from 'd3'

export default function onCorrelationsIndex() {
  const data = [
    ['tag1', 'tag2', 2],
    ['tag1', 'tag3', 20],
    ['tag1', 'tag4', 1],
    ['tag2', 'tag3', 10],
    ['tag2', 'tag4', 19],
    ['tag3', 'tag4', 23]
  ]
  const maxRadius = 20
  const labels = {
    'tag1': 0,
    'tag2': 1,
    'tag3': 2,
    'tag4': 3
  }
  const cellX = d3.scaleLinear().domain([0,4]).range([20,600])
  const cellY = d3.scaleLinear().domain([0,4]).range([20,600])
  const cellR = d3.scaleLinear().domain([0,30]).range([0,maxRadius])

  var svg = d3.select('#correlations')
              .append('svg')
              .attr('width', 600)
              .attr('height', 600)
              .attr("viewbox", "0 0 100 100")
  svg.selectAll(".cell")
     .data(data)
     .enter()
     .append("circle")
     .attr("class", "cell")
     .attr("cx", (d) => cellX(labels[d[0]]))
     .attr("cy", (d) => cellY(labels[d[1]]))
     .attr("r", (d) => cellR(d[2]) )

}

/*
SELECT t1.shortname AS tag1,
	   t2.shortname AS tag2,
	   COUNT(*) AS num
FROM
	vulnerability_tags vt1 INNER JOIN tags t1 ON t1.id = vt1.tag_id,
	vulnerability_tags vt2 INNER JOIN tags t2 ON t2.id = vt2.tag_id
WHERE vt1.vulnerability_id = vt2.vulnerability_id
AND t1.shortname < t2.shortname
AND t1.shortname = ANY(ARRAY['bounty', 'big-fix', 'cooks']::text[])
AND t2.shortname = ANY(ARRAY['bounty', 'big-fix', 'cooks']::text[])
GROUP BY t1.shortname, t2.shortname
*/