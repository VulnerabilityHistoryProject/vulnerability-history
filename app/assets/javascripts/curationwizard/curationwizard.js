import $ from "jquery";
import Toastify from "toastify-js";
import "toastify-js/src/toastify";
const { CweManager } = require("cwe-sdk");
import "select2/dist/js/select2";

function loadProgress() {
  let wizardStatus = JSON.parse(window.localStorage.getItem("VHPWizardStatus"));
  console.log(wizardStatus);
}

function saveProgress(obj) {
  let wizardProgressObj = obj;
  console.log(wizardProgressObj);

  window.localStorage.setItem(
    "VHPWizardStatus",
    JSON.stringify(wizardProgressObj)
  );
}

function loadQuestion() {
  var dataArray = fetch("questions/chromium.json");
  console.log(dataArray);
}
function saveQuestion(questionId, value) {}

export default function curationWizard() {
  loadQuestion();
  const cweManager = new CweManager();
  const result = cweManager.isChildOf({ weaknessId: "117", parentId: "116" });
  //console.log(cweManager.cweDictionary); // true

  //Software Development CWE Category Seeding
  const cweDictArray = Object.values(cweManager.cweDictionary);
  const cweOptions = cweDictArray.map((cwe) => {
    let cweOption = {
      id: cwe.attr["@_ID"],
      text: `#${cwe.attr["@_ID"]}: ${cwe.attr["@_Name"]}`,
      element: HTMLOptionElement,
    };
    return cweOption;
  });
  $("#cwe-id").select2({
    placeholder: "CWE",
    // allowClear: true,
    data: softwareDevelopmentViews,
  });
  $("#cwe-id").on("change", function () {
    let cweNum = this.value;
    const cweSelection = cweDictArray.filter(
      (cweItem) => cweItem.attr["@_ID"] === cweNum
    )[0];
    const yamlField = document.getElementById("YAMLOutput");
    yamlField.innerText = cweSelection.attr["@_ID"];
    Toastify({
      text: "CWE added to YAML.",
      duration: 3000,
      close: true,
      gravity: "top",
      position: "right",
      stopOnFocus: true,
      style: {
        background: "linear-gradient(to right, #00b09b, #96c93d)",
      },
      onClick: function () {
        $("#offCanvas").foundation(
          "open",
          event,
          $("button").data("toggle", "offCanvas")
        );
      },
    }).showToast();
  });

  $("#open-menu").on("click", function () {
    setTimeout(function () {
      $("#YAMLOutput").trigger("focus");
    }, 1000);
  });

  $("#CopyYAML").on("click", function () {
    const yamlField = document.getElementById("YAMLOutput");
    const yamlOutput = yamlField.value;
    // Select the text field
    yamlField.select();
    yamlField.setSelectionRange(0, yamlOutput.length); // For mobile devices

    // Copy the text inside the text field
    navigator.clipboard.writeText(yamlOutput);
    Toastify({
      text: "YAML copied to clipboard",
      duration: 3000,
      close: true,
      gravity: "top", // `top` or `bottom`
      position: "right", // `left`, `center` or `right`
      stopOnFocus: true, // Prevents dismissing of toast on hover
      style: {
        background: "linear-gradient(to right, #00b09b, #96c93d)",
      },
      onClick: function () {}, // Callback after click
    }).showToast();
  });
}
