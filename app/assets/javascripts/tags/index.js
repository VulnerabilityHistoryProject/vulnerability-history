$.urlParam = function(name){
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    if (results==null){
       return '';
    }
    else{
       var values = ['CWE', 'Language', 'Lesson', 'Subsystem'];
       var search = decodeURI(results[1]) || 0;
       if (values.includes(search)){
         return search;
       }
       return '';
    }
}

$( document ).ready( function() {
    $.ajax({
        url: "/api/tags",
        dataType: 'json',
        success: function (jsonData) {
            $('#datatable').dataTable({
                "search": {"search": $.urlParam('search')},
                destroy: true,
                data: jsonData,
                pageLength: 50,
                rowCallback: function(row, data, index){
                    $(row).on('click', function(){
                        var url = '/tags/' + data.id;
                        window.location.assign(url);
                    })
                },
                columns: [
                    {title: '<i class="fi-pricetag-multiple"></i> Tag', data: null, defaultContent: '',
                      render: function(data) {
                        icon = '<i class="fi-pricetag-multiple" style="color: ' + data.color + '"></i> '
                        return  icon + data.name;
                      }
                    },
                    {title: 'Description', data: 'short_desc', defaultContent: ''}
                ],
                initComplete: function () {
                    $('#loading').remove();
                  }
            });
        }
    });
        $('#datatable').on('mouseover', 'tbody tr', function() {
            $(this).css({
                'cursor': 'pointer',
                'color': 'blue'
            });
        })

        $('#datatable').on('mouseout', 'tbody tr', function() {
            $(this).css({
                'cursor': 'default',
                'color': 'inherit'
            });
        })
});
