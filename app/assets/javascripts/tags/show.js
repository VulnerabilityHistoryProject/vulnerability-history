$( document ).ready( function() {
  $.ajax({
    url: "/api/tags/" + tag_id,
    dataType: 'json',
    success: function (jsonData) {
      var search = $('#search').val()
      $('#datatable').dataTable({
        search: {"search": search}
        destroy: true,
        data: jsonData,
        order: [[4, "desc"]], /* Default sort */
        rowCallback: function(row, data, index){
          $(row).on('click', function(){
              var url = '/vulnerabilities/' + data.vulnerability_id;
              window.location.assign(url);
          })
        },
        columns: [
          { title: 'CVE', data: null, defaultContent: '', width: "7em", class: 'text-center',
            render: function(data){
              return vulnName(data);
            }
          },
          { title: 'Description', data: 'short_desc', defaultContent: '', class: 'text-left'},
          { title: 'Curator Note', data: 'tag_note', defaultContent: '', class: 'text-left'},
          { title: 'Announced', data: 'announced', defaultContent: '', class: 'text-center',
            render: function(data) {
              return moment(data).format('MMMM DD, YYYY');
            }
          },
          { title: 'Upvotes', data: 'upvotes', defaultContent: '', class: 'text-center'}        ],
        initComplete: function () {
          $('#loading').remove();
        }
      });
    }
  });
  $('#datatable').on('mouseover', 'tbody tr', function() {
      $(this).css({
          'cursor': 'pointer',
          'color': 'blue'
      });
  })

  $('#datatable').on('mouseout', 'tbody tr', function() {
      $(this).css({
          'cursor': 'default',
          'color': 'inherit'
      });
  })
});
