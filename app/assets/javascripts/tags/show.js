function columnsInfo() {
  return [
    {
      title: '<i class="vhp-icon-tag"></i>Vulnerability',
      data: null,
      defaultContent: '',
      width: "7em",
      class: 'text-center',
      responsivePriority: 1,
      render: (data, type, row) => renderAsLink(vulnProject(data) + vulnName(data), row)
    },
    {
      title: 'Description',
      data: 'short_desc',
      defaultContent: '',
      class: 'text-left',
      responsivePriority: 3,
      render: (data, type, row) => renderAsLink(data, row)
    },
    {
      title: 'Curator Note',
      data: 'tag_note',
      defaultContent: '',
      class: 'text-left',
      responsivePriority: 4,
      render: (data, type, row) => renderAsLink(data, row)
    },
    {
      title: 'Announced',
      data: 'announced',
      defaultContent: '',
      class: 'text-center',
      responsivePriority: 5,
      render: function(data, type, row) {
        //return renderAsLink(moment(data).format('MMMM DD, YYYY'), row);
        if (type === 'display') {
          // Display dates in a nice format.
          return renderAsLink(moment(data).format('MMMM DD, YYYY'), row);
        } else if (type === 'filter') {
          // Allow for the filtering of dates in a variety of formats.
          // The type is "filter" when the search bar is used.
          let currentDate = moment(data);
          let long_display = currentDate.format('MMMM DD, YYYY');
          let short_display = currentDate.format("MM/DD/YYYY");
          return data + " " + long_display + " " + short_display;
        } else {
          // Sort dates without any special formatting.
          return data;
        }
      }
    },
    {
      title: 'Upvotes',
      data: 'upvotes',
      defaultContent: '',
      class: 'text-center',
      responsivePriority: 2,
      render: (data, type, row) => renderAsLink(data, row)
    }
  ]
}


$( document ).ready( function() {
  $.ajax({
    url: "/api/tags/" + tag_id,
    dataType: 'json',
    success: function (jsonData) {
      $('#datatable').dataTable({
        responsive: true,
        destroy: true,
        data: jsonData,
        order: [[4, "desc"]], /* Default sort */
        columns: columnsInfo(),
        columnDefs: [
          { "width": "16%", "targets": 0 },
          { "width": "40%", "targets": 1 }
          // { "width": "20%", "targets": 1 }
        ],
        initComplete: function () {
          $('#loading').remove();
        }
      });
    }
  });
  $('#datatable').on('mouseover', 'tbody tr', function() {
      $(this).css({
          'cursor': 'pointer',
          'color': 'blue'
      });
  })

  $('#datatable').on('mouseout', 'tbody tr', function() {
      $(this).css({
          'cursor': 'default',
          'color': 'inherit'
      });
  })
});

function renderAsLink(data, row) {
    return '<a class="dt_row" href="/vulnerabilities/' + row.vulnerability_id + '">' + data + '</a>';
}
