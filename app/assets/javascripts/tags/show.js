function columnsInfo() {
  return [
    {
      title: '<i class="vhp-icon-tag"></i>Vulnerability',
      data: null,
      defaultContent: '',
      width: "7em",
      class: 'text-center',
      responsivePriority: 1,
      render: (data, type, row) => renderAsLink(vulnProject(data) + vulnName(data), row)
    },
    {
      title: 'Description',
      data: 'short_desc',
      defaultContent: '',
      class: 'text-left',
      responsivePriority: 3,
      render: (data, type, row) => renderAsLink(data, row)
    },
    {
      title: 'Curator Note',
      data: 'tag_note',
      defaultContent: '',
      class: 'text-left',
      responsivePriority: 4,
      render: (data, type, row) => renderAsLink(data, row)
    },
    {
      title: 'Announced',
      data: 'announced',
      defaultContent: '',
      class: 'text-center',
      responsivePriority: 5,
      render: (data, type, row) => renderDateColumn(data, type, row, 'MMMM DD, YYYY', true)
    },
    {
      title: 'Upvotes',
      data: 'upvotes',
      defaultContent: '',
      class: 'text-center',
      responsivePriority: 2,
      render: (data, type, row) => renderAsLink(data, row)
    }
  ]
}


$( document ).ready( function() {
  $.ajax({
    url: "/api/tags/" + tag_id,
    dataType: 'json',
    success: function (jsonData) {
      $('#datatable').dataTable({
        responsive: true,
        destroy: true,
        data: jsonData,
        order: [[4, "desc"]], /* Default sort */
        columns: columnsInfo(),
        columnDefs: [
          { "width": "16%", "targets": 0 },
          { "width": "40%", "targets": 1 }
          // { "width": "20%", "targets": 1 }
        ],
        preDrawCallback: function (settings) {
          // Removes "Previous" and "Next" buttons if there's only one page
          var api = new $.fn.dataTable.Api(settings);
          var pagination = $(this)
            .closest('.dataTables_wrapper')
            .find('.dataTables_paginate');
          pagination.toggle(api.page.info().pages > 1);
        },
        initComplete: function () {
          $('#loading').remove();
        }
      });
    }
  });
  $('#datatable').on('mouseover', 'tbody tr', function() {
      $(this).css({
          'cursor': 'pointer',
          'color': 'blue'
      });
  })

  $('#datatable').on('mouseout', 'tbody tr', function() {
      $(this).css({
          'cursor': 'default',
          'color': 'inherit'
      });
  })
});

function renderAsLink(data, row) {
    return '<a class="dt_row" href="/vulnerabilities/' + row.vulnerability_id + '">' + data + '</a>';
}
