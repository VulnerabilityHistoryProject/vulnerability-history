function buildHorizontalTimeline(vuln_events, project_events){
  window.filters = [];
  var eArray = collectEvents();
  var sEvents = sortEvents(eArray);
  var impDates = getImportantDates(sEvents);
  var minDate = impDates.minDate;
  var maxDate = impDates.maxDate;
  var eVcc = impDates.eVcc;
  var eVuln = impDates.eVuln;
  var lFix = impDates.lFix;

  var margin = {top: 10, right: 60, bottom: 45, left: 60};
  var width = 960 - margin.left - margin.right;
  var height = 270 - margin.top - margin.bottom;

  var minChicHeight = 10;
  var maxChicHeight = 15;
  var chicWidth = 20;
  var cLowerLim = 15;
  var cUpperLim = 25;
  var zoom = false;
  var hiddenTypes = [];

  var h = new HorizontalTimeline(
      sEvents,
      cLowerLim,
      cUpperLim,
      minChicHeight,
      maxChicHeight,
      chicWidth,
      zoom,
      minDate,
      maxDate,
      eVcc,
      eVuln,
      lFix,
      height,
      width,
      margin,
      hiddenTypes
  );

  h.setup();
  h.generate();

  bindDataToggleCallback(h, sEvents, cLowerLim, cUpperLim, minChicHeight, maxChicHeight, chicWidth, zoom,
      minDate, maxDate, eVcc, eVuln, lFix, height, width, margin);
  bindCdTimelineEvents();
  bindWindowEvents();
  bindScrollEvents();
  bindZoomEvents(h, sEvents, cLowerLim, cUpperLim, minChicHeight, maxChicHeight, chicWidth, minDate, maxDate,
      eVcc, eVuln, lFix, height, width, margin);
}

function buildVerticalTimeline(vuln_events) {
  vtimeline = $('#vtimeline');
  for (let e of vuln_events) {
    block = $('#vtimeline-template').clone();
    block.attr('id', 'event_block_' + e.id);
    block.attr('data-id', e.id);
    block.find('.vtimeline-anchor').attr('id',"event_" + e.id);
    block.find('#title').html(e.title);
    block.find('#description').html(e.description);
    block.find('#isodate').html(e.date);
    block.find('#pretty_date').html(moment(e.date).format('MMMM DD, YYYY'));
    block.find('#timeline-icon').html(e.style_icon);
    block.find('.vtimeline-img').css('background-color', e.style_color);
    vtimeline.append(block);
    block.show();
  }
  $('#vtimeline-template').remove(); // remove so we start upper-left
}

$( document ).ready( function() {
  $.ajax({
    url: "/api/vulnerabilities/" + vulnerability_id + "/events",
    dataType: 'json',
    success: function (vuln_events) {
      $('#vtimeline_loading').remove();
      buildVerticalTimeline(vuln_events);
      $('#loading').remove();
      // buildHorizontalTimeline();
    }
  });
});
