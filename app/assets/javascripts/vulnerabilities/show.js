function initHTimeline(){
  window.filters = [];
  settings = {
    margin: { top: 10, bottom: 45, left: 60, right: 60},
    minChicHeight: 10,
    maxChicHeight: 15,
    chicWidth: 20,
    cLowerLim: 15,
    cUpperLim: 25,
    zoom: false,
    hiddenTypes: [],
    xAxisHeight: 43,
    fade_ms: 700,
  }

  var h = new HorizontalTimeline(settings);
  h.init();

  // bindDataToggleCallback(h, sEvents, cLowerLim, cUpperLim, minChicHeight, maxChicHeight, chicWidth, zoom,
  //     minDate, maxDate, eVcc, eVuln, lFix, height, width, margin);
  bindCdTimelineEvents();
  bindWindowEvents();
  bindScrollEvents();
  // bindZoomEvents(h, sEvents, cLowerLim, cUpperLim, minChicHeight, maxChicHeight, chicWidth, minDate, maxDate,
  //     eVcc, eVuln, lFix, height, width, margin);
  return h;
}

function populateHTimeline(hTimeline, vuln_events) {
  // var eArray = collectEvents();
  // var sEvents = sortEvents(eArray);
  // var impDates = getImportantDates(vuln_events);
  // minDate: impDates.minDate,
  // maxDate: impDates.maxDate,
  // eVcc: impDates.eVcc,
  // eVuln: impDates.eVuln,
  // lFix: impDates.lFix,
  // h.generate();
}

function populateVTimeline(vuln_events) {
  for (let e of vuln_events) {
    block = $('#vtimeline-template').clone();
    block.attr('id', 'event_block_' + e.id);
    block.attr('data-id', e.id);
    block.find('.vtimeline-anchor').attr('id',"event_" + e.id);
    block.find('#title').html(e.title);
    block.find('#description').html(e.description);
    block.find('#isodate').html(e.date);
    block.find('#pretty_date').html(moment(e.date).format('MMMM DD, YYYY'));
    block.find('#timeline-icon').html(e.style_icon);
    block.find('.vtimeline-img').css('background-color', e.style_color);
    $('#vtimeline').append(block);
    block.show();
  }
  $('#vtimeline-template').remove(); // remove so we start upper-left
}

$( document ).ready( function() {
  var hTimeline = initHTimeline();

  // MOVE TO PROMISE
  $('#loading').remove();
  // start with two events temporarily
  var events = [
    new Event1(1, 'Event 1', 'hi.', new Date('2014-03-05T05:11:22.000+00:00'), 'Fix', '#f00', 'icon'),
    new Event1(2, 'Event 2', 'hi.', new Date('2015-03-05T05:11:22.000+00:00'), 'Vcc', '#f00', 'icon'),
  ];

  populateHTimeline(hTimeline, events);

  $.ajax({
    url: "/api/vulnerabilities/" + vulnerability_id + "/events",
    dataType: 'json',

  }).done(function(vuln_events){
    $('#vtimeline_loading').remove();
    populateVTimeline(vuln_events);
  }).done(function(vuln_events) {

  });
});
