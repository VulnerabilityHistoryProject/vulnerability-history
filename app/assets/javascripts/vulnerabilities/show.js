function buildHorizontalTimeline(vuln_events, project_events){
  window.filters = [];
  // var eArray = collectEvents();
  // var sEvents = sortEvents(eArray);
  var impDates = getImportantDates(vuln_events);
  settings = {
    margin: { top: 10, bottom: 45, left: 60, right: 60},
    minChicHeight: 10,
    maxChicHeight: 15,
    chicWidth: 20,
    cLowerLim: 15,
    cUpperLim: 25,
    zoom: false,
    hiddenTypes: [],
    minDate: impDates.minDate,
    maxDate: impDates.maxDate,
    eVcc: impDates.eVcc,
    eVuln: impDates.eVuln,
    lFix: impDates.lFix,
  }

  var h = new HorizontalTimeline(vuln_events, settings);

  h.setup();
  h.generate();

  // bindDataToggleCallback(h, sEvents, cLowerLim, cUpperLim, minChicHeight, maxChicHeight, chicWidth, zoom,
  //     minDate, maxDate, eVcc, eVuln, lFix, height, width, margin);
  bindCdTimelineEvents();
  bindWindowEvents();
  bindScrollEvents();
  // bindZoomEvents(h, sEvents, cLowerLim, cUpperLim, minChicHeight, maxChicHeight, chicWidth, minDate, maxDate,
  //     eVcc, eVuln, lFix, height, width, margin);
}

function populateVTimeline(vuln_events) {
  for (let e of vuln_events) {
    block = $('#vtimeline-template').clone();
    block.attr('id', 'event_block_' + e.id);
    block.attr('data-id', e.id);
    block.find('.vtimeline-anchor').attr('id',"event_" + e.id);
    block.find('#title').html(e.title);
    block.find('#description').html(e.description);
    block.find('#isodate').html(e.date);
    block.find('#pretty_date').html(moment(e.date).format('MMMM DD, YYYY'));
    block.find('#timeline-icon').html(e.style_icon);
    block.find('.vtimeline-img').css('background-color', e.style_color);
    $('#vtimeline').append(block);
    block.show();
  }
  $('#vtimeline-template').remove(); // remove so we start upper-left
}

$( document ).ready( function() {
  // var vuln_events = []; // start empty before AJAX call
  var vuln_events = [
    new Event1(1, 'Event 1', 'hi.', '2014-03-05T05:11:22.000+00:00', 'Fix', '#f00', 'icon'),
    new Event1(2, 'Event 2', 'hi.', '2015-03-05T05:11:22.000+00:00', 'Vcc', '#f00', 'icon'),
  ]; // start with two events temporarily
  var project_events = []; // start empty before AJAX call
  buildHorizontalTimeline(vuln_events, project_events);

  $.ajax({
    url: "/api/vulnerabilities/" + vulnerability_id + "/events",
    dataType: 'json',
    success: function (vuln_events) {
      $('#vtimeline_loading').remove();
      populateVTimeline(vuln_events);
      $('#loading').remove();
      // trigger update to horiztonalTimeline once these are done
    }
  });
});
