$( document ).ready( function() {
    $.ajax({
        url: "/api/releases",
        dataType: 'json',
        success: function(jsonData) {
            $('#datatable').dataTable({
                destroy: true,
                data: jsonData,
                rowCallback: function(row, data, index){
                    $(row).on('click', function(){
                        var url = window.location.href;
                        if (url.slice(-1) === "/"){
                            url += data.id;
                        } else {
                            url += '/' + data.id;
                        }
                        window.location.assign(url);
                    })
                },
                columnDefs: [
                    { "width": "10%", "targets": 0 }
                ],
                columns: [
                    { title: 'Title', data: 'name', defaultContent: 'Null'},
                    { title: 'Browser Engine', data: 'notes.browser_eng', defaultContent: 'Null'},
                    { title: 'Date', data: 'date_released', defaultContent: 'Null',
                        render: function(data) {
                            return moment(data).format('MMMM DD YYYY, h:mm a');
                        }
                    },
                    { title: 'Description', data: 'notes.changes', defaultContent: 'Null'}
                ],
                initComplete: function () {
                    $('#loading').remove();
                }
            });
        }
    });

    $('#datatable').on('mouseover', 'tbody tr', function() {
        $(this).css({
            'cursor': 'pointer',
            'color': 'blue'
        });
    });

    $('#datatable').on('mouseout', 'tbody tr', function() {
        $(this).css({
            'cursor': 'default',
            'color': 'inherit'
        });
    })
});
