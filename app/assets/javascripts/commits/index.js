$( document ).ready( function() {
    $.ajax({
        url: "/api/commits",
        dataType: 'json',
        success: function(jsonData) {
            $('#datatable').dataTable({
                destroy: true,
                data: jsonData,
                rowCallback: function(row, data, index){
                  $(row).on('click', function(){
                    var url = window.location.href;
                    if (url.slice(-1) == "/"){
                      url += data.id;
                    } else {
                      url += '/' + data.id;
                    }
                    window.location.assign(url);
                  })
                },
                preDrawCallback: function (settings) {
                    // Removes "Previous" and "Next" buttons if there's only one page
                    var api = new $.fn.dataTable.Api(settings);
                    var pagination = $(this)
                        .closest('.dataTables_wrapper')
                        .find('.dataTables_paginate');
                    pagination.toggle(api.page.info().pages > 1);
                },
                columnDefs: [
                  { "width": "10%", "targets": 0 }
                ],
                columns: [
                    { title: 'Commit Hash', data: 'commit_hash', defaultContent: ''},
                    { title: 'Author', data: 'email', defaultContent: ''},
                    { title: 'Date Created', data: 'date_created', defaultContent: '',
                      render: function(data) {
                        return moment(data,'YYYY-MM-DD hh:mm:ss Z')
                               .format('MMMM Do YYYY, h:mm a');
                      }
                    }
                ]
            });
        }
    });

    $('#datatable').on('mouseover', 'tbody tr', function() {
        $(this).css({
           'cursor': 'pointer',
            'color': 'blue'
        });
    })

    $('#datatable').on('mouseout', 'tbody tr', function() {
        $(this).css({
            'cursor': 'default',
            'color': 'inherit'
        });
    })
});
