$( document ).ready( function() {
    $.ajax({
        url: "/api/developers/" + $('#developer_id').text() + "/commits",
        dataType: 'json',
        success: function(jsonData) {
            $('#datatable').dataTable({
                destroy: true,
                data: jsonData,
                rowCallback: function(row, data, index){
                  $(row).on('click', function(){
                    var url = "/commits/" + data.id;
                    window.location.assign(url);
                  })
                },
                columnDefs: [
                  { "width": "10%", "targets": 0 }
                ],
                columns: [
                  { title: 'Commit Hash', data: 'commit_hash', defaultContent: 'Null'},
                  { title: 'Author ID', data: 'author_id', defaultContent: 'Null'},
                  { title: 'Date Created', data: 'date_created', defaultContent: 'Null',
                    render: function(data) {
                      return moment(data).format('MMMM Do YYYY, h:mm a');
                    }
                  }
                ]
            });
        }
    });

    $('#datatable').on('mouseover', 'tbody tr', function() {
        $(this).css({
           'cursor': 'pointer',
            'color': 'blue'
        });
    })

    $('#datatable').on('mouseout', 'tbody tr', function() {
        $(this).css({
            'cursor': 'default',
            'color': 'inherit'
        });
    })

    $('#email_fetch').on('click', function() {
        $.ajax({
            url: "/api/developers/" + $('#developer_id').text(),
            dataType: 'json',
            success: function(jsonData) {
              $('#email_fetch').hide();
              $('#developer_email').html(jsonData.email);
              $('#developer_email').show();
              $('#github_search').prop('href', "https://github.com/search?q=" + jsonData.email + "&type=Users");
              $('#github_search').html("<i class=\"vhp-icon-github\"></i> Search " + jsonData.email + " on GitHub");
              $('#github_search').show();
            },
            error: function() {
              if ($('#email_fetch').html() == "Failed. Retry?") {
                $('#email_fetch').html("Retry again?");
              } else {
                $('#email_fetch').html("Failed. Retry?");
              }
            }
        });
    })
});
