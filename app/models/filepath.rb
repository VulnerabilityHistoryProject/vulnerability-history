class Filepath < ApplicationRecord
  has_many :commit_filepaths, foreign_key: 'filepath_id'
  has_many :commits, through: :commit_filepaths
  has_many :developers, through: :commits

  validates :filepath, :uniqueness => true

  def self.vulnerable(v)
    Filepath.joins(commits: :fixes).
             where('fixes.vulnerability_id' => v.id).
             distinct
  end

  def self.known_offenders
    Filepath.joins(commits: :fixes).distinct
  end

end
