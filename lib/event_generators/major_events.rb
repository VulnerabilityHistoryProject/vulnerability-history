class MajorEvents

  def generate
    Vulnerability.all.each do |vuln|
      vuln.notes['major_events']['events'].each do |e|
        if has_major_event? e
          Event.create!(
            detail: vuln,
            style: style,
            title_template: "Major Event: #{e['name']}",
            type_template: 'major event',
            date_template: e['date'],
            description_template: vuln.notes['major_events']['answer']
          )
        end
      end
    end
  end


private
  def has_major_event?(e)
    !e['date'].nil?
  end

  def style
    @style ||= Style.find_or_create_by!(
      name: 'major_event',
      icon: 'notifications_active',
      color: '#2ac9a6',
    )
  end
end
