require_relative '../../app/helpers/application_helper'

class VulnerabilityEvents
  include ApplicationHelper

  def initialize(project)
    @project = project
  end

  def generate
    Vulnerability.where(project: @project).each do |v|
        e = Event.create!(
          style: style,
          date: v.announced,
          event_type: 'announced',
          title: "Vulnerability Announced for #{v.cve}",
          description: markdown("The vulnerability was officially announced by the development team."),
          start_hidden: false
        )
        v.events << e
        v.save
    end
  end

  def style
    @style ||= Style.find_or_create_by!(
      name: 'announced',
      icon: 'bug_report',
      color: '#9DD5D5',
    )
  end

end
