class VulnerabilityEvents

  def generate
    Vulnerability.joins(filepaths: { vulnerabilities: :fixes } ).distinct.each do |vulnerability|
      unless already_exists?(commit)
        Event.create(
          detail: vulnerability,
          title_template: 'Edit: :title:',
          description_template: <<-EOS
            Vulnerable code was edited.

            :description:
          EOS
        )
      end
    end
  end

  # Don't generate Fix events and VCC events - we'll do those separately
  def already_exists?(vulnerability)
     Fix.where(commit: commit).exists? || Vcc.exists?(commit: commit)
  end

end
