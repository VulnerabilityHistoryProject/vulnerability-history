class SimilarEvents

  def generate
    Vulnerability.all.each do |vuln|
      Vulnerability.all.each do |vuln2|
        if vuln != vuln2
          if vuln.notes['CWE'] and vuln.notes['CWE'] == vuln2.notes['CWE']
            e = Event.create!(
              detail: vuln,
              title_template: vuln2.cve + " has same cve"
              date_template:  vunl2.announced
              description_template: vuln2.cve + " has the same CWE"
            )
          elsif similar_files(vuln, vuln2)

          end
        end
      end
    end
  end

  def similar_files(vuln, vuln2)
    Filepath.vulnerable(vuln).each do |vf|
      Filepath.vulnerable(vuln2).each do |vf2|
        dirs1 = vf.split('\\')[0...-1]
        dirs2 = vf.split('\\')[0...-1]
        if dirs1.length != dirs2.length
          return false
        else
          while i < dirs1.length
            if dirs1[i] != dirs2[i]
              return false
            end
          end
          return true
        end
      end
    end
  end

  def style
    @style ||= Style.find_or_create_by!(
      name: 'fix',
      icon: 'lock',
      color: '#6FD56E',
    )
  end

end
