class CommitEvents

  def generate
    Commit.joins(filepaths: { commits: :fixes } ).distinct.each do |commit|
      unless already_exists?(commit)
        Event.create!(
          detail: commit,
          style: style,
          title_template: 'Edit: :title:',
          description_template:
            File.read(File.expand_path("../markdown/commit.md", __FILE__,))
        )
      end
    end
  end

  def style
    @style ||= Style.find_or_create_by!(
      name: 'commit',
      icon: 'edit',
      color: '#6AA5E5'
    )
  end

  # Don't generate Fix events and VCC events - we'll do those separately
  def already_exists?(commit)
     Fix.where(commit: commit).exists? || Vcc.exists?(commit: commit) || InterestingCommit.exists?(commit: commit)
  end

end
