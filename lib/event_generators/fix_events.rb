class FixEvents

  def generate
    events = []
    vuln_events = []
    Fix.all.each do |fix|
      e = Event.create!(
        detail: fix,
        style: style,
        title_template: ':title:',
        type_template: 'fix',
        description_template:
          File.read(File.expand_path("../markdown/fix.md", __FILE__,))
      )
      events << e
      vuln_events << VulnerabilityEvent.new( vulnerability_id: fix.vulnerability_id,
                                             event: e )
    end
    Event.import events
    VulnerabilityEvent.import vuln_events
  end

  def style
    @style ||= Style.find_or_create_by!(
      name: 'fix',
      icon: 'lock',
      color: '#9FE69F',
    )
  end

end
