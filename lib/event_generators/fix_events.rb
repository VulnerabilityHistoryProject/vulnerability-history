class FixEvents

  def generate
    Fix.joins(filepaths: { commits: :commits } ).distinct.each do |fix|
      unless already_exists?(fix)
        Event.create(
          detail: fix,
          style: style,
          title_template: 'Fixed. :title:',
          description_template: <<-EOS
             Vulnerability was fixed in this commit. Commit message:

            :description:
          EOS
        )
      end
    end
  end

  def style
    @style ||= Style.find_or_create_by!(
      name: 'fix',
      icon: 'edit',
      color: '#6AA5E5'
    )
  end

  def already_exists?(fix)
     Commit.where(fix: fix).exists?
  end
end
