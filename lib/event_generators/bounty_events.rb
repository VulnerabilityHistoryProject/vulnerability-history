class BountyEvents
  def generate
    Vulnerability.all.each do |vulnerability|
      if has_bounty? vulnerability
        Event.create!(
          detail: vulnerability,
          style: style,
          title_template: 'Bounty awarded for :title:',
          type_template: 'bounty',
          description_template: <<-EOS
            A bounty of :notes~bounty: was awarded by the Chromium team
          EOS
        )
      end
    end
  end

  private

  # Returns true if the vulnerability has a bounty
  def has_bounty?(v)
    v.notes.key? 'bounty'
  end

  def style
    @style ||= Style.find_or_create_by!(
      name: 'bounty',
      icon: 'monetization_on',
      color: '#1FA31D'
    )
  end

end
