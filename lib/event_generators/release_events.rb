class ReleaseEvents
  def generate
    events = create_release_events
    associate_with_vulnerabilities events
  end

  def create_release_events
    events = []
    Release.all.each do |release|
      events << Event.create!(
        detail: release,
        style: style,
        title_template: ':title:',
        description_template:
          File.read(File.expand_path("../markdown/release.md", __FILE__,))
      )
    end
    return events
  end

  def associate_with_vulnerabilities(events)
    # vuln_events = []
    # Vulnerability.all.each do |v|
    #   events.each do |e|
    #     vuln_events << VulnerabilityEvent.new(vulnerability: v,
    #                                           event: e)
    #   end
    # end
    # VulnerabilityEvent.import vuln_events
    # TODO Instead of associating with vulnerabilities, let's just poll them ourselves
  end

  def style
    @style ||= Style.find_or_create_by!(
      name: 'release',
      icon: 'stars',
      color: '#D57BCE',
    )
  end
end
