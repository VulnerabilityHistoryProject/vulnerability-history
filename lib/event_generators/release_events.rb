require_relative '../../app/helpers/application_helper'

class ReleaseEvents
  include ApplicationHelper

  def initialize(project)
    @project = project
    @desc = Writing.event_article('release')
    @style ||= Style.find_or_create_by!(
      name: 'release',
      icon: 'stars',
      color: '#D57BCE'
    )
  end

  def generate
    Release.all.each do |release|
      release.notes["title"] = "Major Release: #{release.name}"
      release.notes["description"] = markdown(Writing.embed_details(@desc, release))
      release.notes["event_type"] = @style.name
      release.notes["color"] = @style.color
      release.notes["icon"] = @style.icon
      release.save
    end
  end
end
