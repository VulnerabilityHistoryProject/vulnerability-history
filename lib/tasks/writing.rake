require 'git'
require 'yaml'
require 'fileutils'

logger = Logger.new(STDOUT, progname: 'data:chromium')

namespace :data do

  desc 'Pull latest vhp-writing repo'
  task :writing => [
    'environment',
    'writing:github_clone',
  ]

  namespace :writing do

    repo_name = 'vhp-writing'
    tmp_dir = "./tmp/checkout/" + repo_name
    git_branch = 'master'

    desc 'Perform github clone of vhp-writing'
    task :github_clone do
      logger.info "Removing git #{tmp_dir}..."
      FileUtils.rm_rf tmp_dir if (File.exist?(tmp_dir))
      logger.info "Cloning repo from GitHub on #{git_branch}..."
      g = Git.clone('git://github.com/VulnerabilityHistoryProject/vhp-writing.git',
                    repo_name,
                    path: './tmp/checkout',
                    branch: git_branch)
      logger.info "Loaded data version: #{g.object('HEAD').sha}"
    end
  end

end
