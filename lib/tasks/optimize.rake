logger = Logger.new(STDOUT, progname: 'data')

namespace 'data' do
  desc 'Optimize tables '
  task :optimize => :environment do
    logger.info "Optimizing tables"
    ActiveRecord::Base.connection.execute "CLUSTER vulnerabilities USING index_vulnerabilities_on_upvotes"
    ActiveRecord::Base.connection.execute "CLUSTER vulnerability_events USING index_vulnerability_events_on_vulnerability_id"
    ActiveRecord::Base.connection.execute "CLUSTER vulnerability_tags USING index_vulnerability_tags_on_tag_id_and_vulnerability_id"
    ActiveRecord::Base.connection.execute "ANALYZE events"
    ActiveRecord::Base.connection.execute "ANALYZE vulnerabilities"
    ActiveRecord::Base.connection.execute "ANALYZE vulnerability_events"
    ActiveRecord::Base.connection.execute "ANALYZE vulnerability_tags"
    ActiveRecord::Base.connection.execute "ANALYZE tags"
  end
end
