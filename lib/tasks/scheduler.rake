desc "This task is called by the Heroku scheduler add-on. It also will download a git repo to a directory. Put in lib/tasks"
require 'git'
require 'find'
require 'yaml'
task :cloneGit => :environment do
g = Git.clone('https://github.com/andymeneely/chromium-vulnerabilities.git', 'chromium-vulnerabilities', :path => './tmp/checkout')
    ymlFiles = []
    parsed = []
    Find.find('./tmp/checkout/chromium-vulnerabilities/cves') do |path|
        ymlFiles << path if path=~ /.*\.yml$/
    end
    puts ymlFiles
    for name in ymlFiles
        #file = File.open(name, "r")
        #contents = file.read
        #puts contents
        parsedItem = begin
            YAML.load(File.open(name))
        rescue ArgumentError => e
            puts "Could not parse YAML: #{e.message}"
        end
        parsed.push(parsedItem)
    end

    parsed.each do |parsedToSave|
        puts parsedToSave
        #posts = Post.new
        #puts parsedToSave["gem"]
        #posts.title = parsedToSave["gem"]
        #puts parsedToSave["description"]
        #posts.body = parsedToSave["description"]
        #posts.save
    end
    #puts parsed
end