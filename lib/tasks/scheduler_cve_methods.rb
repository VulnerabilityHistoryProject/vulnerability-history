########################################
# Releases and Vulnerability Functions #
########################################
class Scheduler_CVE_Methods

  def self.vulnerabilityData(vuln_data, event_added = "")
    vuln = Vulnerability.create!(
      cve: vuln_data["CVE"],
      announced: vuln_data["announced"],
      description: vuln_data["description"].to_s,
      notes: vuln_data.except("cve"),
    )
    return vuln.id
  end

  def self.add_vuln_data_to_db(data, vuln_id, type)
    unless data.nil?
      data.each do |entry|
        case entry
        when Hash
          entry.each do |hash, message|
            d = type.new
            d.vulnerability_id = vuln_id
            commit = Commit.find_by commit_hash: hash
            if commit.nil?
              puts "WARNING: Missing commit data for #{hash}"
            else
              d.commit_id = commit.id
            end
            d.notes = message["note"]
            d.save
          end
        when String
          d = type.new
          commit = Commit.find_by commit_hash: hash
          if commit.nil?
            puts "WARNING: Missing commit data for #{hash}"
          else
            d.commit_id = commit.id
          end
          d.vulnerability_id = vuln_id
          d.notes = ""
          d.save
        end
      end
    end
  end

end
