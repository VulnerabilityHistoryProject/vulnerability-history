########################################
# Releases and Vulnerability Functions #
########################################
class Scheduler_CVE_Methods
  def self.releaseData(parsed, projectName)
      parsed["releases"].each do |key, date|
        release = Release.new
        release.number = key
        release.date_released = date
        release.project = projectName
        #Something needs to go here
        release.notes = "hello"
        release.save
        style = Style.find_by(name: 'release')
        Event.create!(detail: release, style: style)
      end
  end
  def self.vulnerabilityData(vuln_data, event_added = "")
    cve = vuln_data["CVE"]
    #vuln_data table
    vuln = Vulnerability.new
    vuln.cve = cve
    vuln.announced = vuln_data["announced"]
    vuln.description = vuln_data["description"].to_s
    vuln.notes = vuln_data.except("cve")
    vuln.save
    # Generate event
    vuln_style = Style.find_by(name: 'vulnerability')
    Event.create!(detail: vuln, style: vuln_style)
    if(event_added != "")
      event = Event.create!(detail: vuln, style: vuln_style)
      event.save
    end
    return vuln_id = vuln.id
  end
  def self.add_vuln_data_to_db(data, vuln_id, type)
    unless data.nil?
      style = Style.find_by(name: type.to_s.downcase)
      data.each do |entry|
        case entry
        when Hash
          entry.each do |hash, message|
            d = type.new
            d.vulnerability_id = vuln_id
            d.commit_id = (Commit.find_by commit_hash: hash).id
            d.notes = message["note"]
            d.save
            Event.create!(detail: d, style: style)
          end
        when String
          d = type.new
          d.commit_id = (Commit.find_by commit_hash: entry).id
          d.vulnerability_id = vuln_id
          d.notes = ""
          d.save
          Event.create!(detail: d, style: style)
        end
      end
    end
  end
  def self.add_event_styles
      Style.create!(name: 'vulnerability', color: '#F3A23A', icon: 'bug_report')
      Style.create!(name: 'fix', color: '#6FD56E', icon: 'build')
      Style.create!(name: 'vcc', color: '#ED6049', icon: 'report_problem')
      Style.create!(name: 'release', color: '#D270CA', icon: 'stars')
      Style.create!(name: 'commit', color: '#6AA5E5', icon: 'edit')
  end
end
