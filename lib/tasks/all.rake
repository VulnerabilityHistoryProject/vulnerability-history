desc 'Clean rebuild of ALL data: Chromium, HTTPD'
namespace :data do
  task :all => ['environment', 'data:no_logger', 'data:clear'] do
    Rake::Task['data:writing:github_clone']
    Rake::Task['data:writing:github_clone'].reenable
    Rake::Task['data:build'].invoke('chromium')
    Rake::Task['data:build'].reenable
    Rake::Task['data:build'].invoke('httpd')
    Rake::Task['data:build'].reenable
    Rake::Task['data:build'].invoke('tomcat')
    Rake::Task['data:build'].reenable
    Rake::Task['data:build'].invoke('struts')
    Rake::Task['data:build'].reenable
    Rake::Task['data:writing']
    Rake::Task['data:writing'].reenable
    Rake::Task['data:done']
    Rake::Task['data:done'].reenable
  end

  desc 'Disable AR logging, for performance'
  task :no_logger => :environment do
    ActiveRecord::Base.logger = nil
  end

  desc 'Show some basic stats when the build is done'
  task :done => :environment do
    logger = TimingLogger.new(STDOUT, 'data:done')
    logger.info "#{Vulnerability.count} vulnerabilities"
    logger.info "#{Event.count} events"
    logger.info "#{Tag.count} tags"
    logger.info "#{Developer.count} developers"
    logger.info "#{Article.count} articles"
    logger.info "#{Filepath.count} filepaths"
    logger.done
  end

end
