require 'erb'

namespace 'db' do
  desc '(VHP) Rebuild database schemas w/tenants'
  task :rebuild => ['db:drop', 'db:create'] do
     erb = ERB.new(File.read('db/structure.sql.erb'))
     File.open('db/structure.sql', 'w+') do |sql|
       sql.write(erb.result(binding))
     end
     puts "Wrote structure.sql"
     Rake::Task["db:structure:load"].invoke
     puts "Invoked db:structure:load"
  end
end
