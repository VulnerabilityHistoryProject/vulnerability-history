desc 'Test out activerecord-import'
task :bulk_fun => [:environment, 'data:clear'] do
  foo = Developer.new email: 'foo'
  bar = Developer.new email: 'bar'
  devs = [foo, bar]

  a_dot_c = Filepath.new filepath: 'a.c'
  b_dot_c = Filepath.new filepath: 'b.c'
  filepaths = [a_dot_c, b_dot_c]

  commits = []
  edits = []
  c1 = Commit.new(
    commit_hash: 'abcd',
    date_created: '2011-01-01',
    message: 'blah',
    developer: foo
  )
  commits << c1

  c2 = Commit.new(
    commit_hash: 'abcde',
    date_created: '2011-01-01',
    message: 'blah',
    developer: bar
  )
  e = CommitFilepath.new(commit: c2, filepath: a_dot_c, total_churn: 5)
  c2.commit_filepaths << e
  commits << c2

  c3 = Commit.new(
    commit_hash: 'abcdef',
    date_created: '2011-01-01',
    message: 'blah',
    developer: bar
  )
  e = CommitFilepath.new(commit: c2, filepath: a_dot_c, total_churn: 5)
  c3.commit_filepaths << e
  commits << c3

  Developer.import devs, validate: false
  Filepath.import filepaths, validate: false
  Commit.import commits, recursive: true, validate: false

  puts "Done! Here's the database..."
  puts Developer.all.to_json
  puts Commit.all.to_json
  puts Filepath.all.to_json
  puts CommitFilepath.all.to_json
  # puts results.to_json
end
