require 'test_helper'
require_relative '../scheduler_methods'
require 'date'
class SchedulerTest < ActiveSupport::TestCase
  #currently one test since this data is checked in yaml parsing tests
  test "vulnerabilities test correct data" do
    parsedToSave = {"CVE-2011-3092"=>{"bounty"=>"$1000.00", "announced"=>{"date"=>DateTime.new(2012,5,15), "url"=>"http://googlechromereleases.blogspot.com/2012/05/stable-channel-update.html"}, "code_reviews"=>[39004], "bugs"=>[122337], "fixes"=>["f3e8965444b0b615ed8aabfcacc5840f6684c0c5"], "files"=>{"webkit/port/DerivedSources.make"=>{"note"=>"Yes, this is a vulnerability in a Makefile", "vccs"=>[{"4bab3b214e92e0884af87c4ae9287da3daff5f3d"=>{"note"=>"The original logic didnt handle the crossplatform line endings when the original Webkit port was brought in."}}, {"6fe4e841191055b69f5df33002e78d75bfdcf725"=>{"note"=>"They worked on the Windows encodings for this one"}}]}, "DEPS"=>{"note"=>"They also decided to upgrade Cygwin to fix this."}}}}
    assert vulnerabilityData(parsedToSave)
  end
  #currently one test since this data is checked in yaml parsing tests
  test "fixes test correct data" do
    parsedToSave = {"CVE-2011-3092"=>{"bounty"=>"$1000.00", "announced"=>{"date"=>DateTime.new(2012,5,15), "url"=>"http://googlechromereleases.blogspot.com/2012/05/stable-channel-update.html"}, "code_reviews"=>[39004], "bugs"=>[122337], "fixes"=>["f3e8965444b0b615ed8aabfcacc5840f6684c0c5"], "files"=>{"webkit/port/DerivedSources.make"=>{"note"=>"Yes, this is a vulnerability in a Makefile", "vccs"=>[{"4bab3b214e92e0884af87c4ae9287da3daff5f3d"=>{"note"=>"The original logic didnt handle the crossplatform line endings when the original Webkit port was brought in."}}, {"6fe4e841191055b69f5df33002e78d75bfdcf725"=>{"note"=>"They worked on the Windows encodings for this one"}}]}, "DEPS"=>{"note"=>"They also decided to upgrade Cygwin to fix this."}}}}
    assert fixesData(parsedToSave)
  end
  #check file and vccs data
  test "file/vccs test correct data" do
    parsedToSave = {"CVE-2011-3092"=>{"bounty"=>"$1000.00", "announced"=>{"date"=>DateTime.new(2012,5,15), "url"=>"http://googlechromereleases.blogspot.com/2012/05/stable-channel-update.html"}, "code_reviews"=>[39004], "bugs"=>[122337], "fixes"=>["f3e8965444b0b615ed8aabfcacc5840f6684c0c5"], "files"=>{"webkit/port/DerivedSources.make"=>{"note"=>"Yes, this is a vulnerability in a Makefile", "vccs"=>[{"4bab3b214e92e0884af87c4ae9287da3daff5f3d"=>{"note"=>"The original logic didnt handle the crossplatform line endings when the original Webkit port was brought in."}}, {"6fe4e841191055b69f5df33002e78d75bfdcf725"=>{"note"=>"They worked on the Windows encodings for this one"}}]}, "DEPS"=>{"note"=>"They also decided to upgrade Cygwin to fix this."}}}}
    assert fileData(parsedToSave)
  end
  #check file and vccs data no notes
  test "file/vccs test no notes for files" do
    parsedToSave = {"CVE-2011-3092"=>{"bounty"=>"$1000.00", "announced"=>{"date"=>DateTime.new(2012,5,15), "url"=>"http://googlechromereleases.blogspot.com/2012/05/stable-channel-update.html"}, "code_reviews"=>[39004], "bugs"=>[122337], "fixes"=>["f3e8965444b0b615ed8aabfcacc5840f6684c0c5"], "files"=>{"webkit/port/DerivedSources.make"=>{"vccs"=>[{"4bab3b214e92e0884af87c4ae9287da3daff5f3d"=>{"note"=>"The original logic didnt handle the crossplatform line endings when the original Webkit port was brought in."}}, {"6fe4e841191055b69f5df33002e78d75bfdcf725"=>{"note"=>"They worked on the Windows encodings for this one"}}]}, "DEPS"=>{}}}}
    assert fileData(parsedToSave)
  end
  #check file and vccs data no notes
  test "file/vccs test no notes for vccs" do
    parsedToSave = {"CVE-2011-3092"=>{"bounty"=>"$1000.00", "announced"=>{"date"=>DateTime.new(2012,5,15), "url"=>"http://googlechromereleases.blogspot.com/2012/05/stable-channel-update.html"}, "code_reviews"=>[39004], "bugs"=>[122337], "fixes"=>["f3e8965444b0b615ed8aabfcacc5840f6684c0c5"], "files"=>{"webkit/port/DerivedSources.make"=>{"vccs"=>[{"4bab3b214e92e0884af87c4ae9287da3daff5f3d"=>{}}]}, "DEPS"=>{}}}}
    assert fileData(parsedToSave)
  end
end