require 'test_helper'
require_relative '../scheduler_methods'
require 'date'
class SchedulerTest < ActiveSupport::TestCase
  #rails test lib/tasks/tests/scheduler_test.rb
  #currently one test since this data is checked in yaml parsing tests
  test "vulnerabilities test correct data" do
    parsedToSave = {"CVE"=>"CVE-2011-3092", "bounty"=>"$1000.00", "announced"=>{"date"=>DateTime.new(2012,5,15), "url"=>"http://googlechromereleases.blogspot.com/2012/05/stable-channel-update.html"}, "code_reviews"=>[39004], "bugs"=>[122337], "fixes"=>["f3e8965444b0b615ed8aabfcacc5840f6684c0c5"], "vccs"=>[{"4bab3b214e92e0884af87c4ae9287da3daff5f3d"=>{"note"=>"The original logic didnt handle the crossplatform line endings when the original Webkit port was brought in. Yes, this is a vulnerability in a Makefile."}}, {"6fe4e841191055b69f5df33002e78d75bfdcf725"=>{"note"=>"They worked on the Windows encodings for this one. They also decided to upgrade Cygwin to fix this."}}]}
    assert vulnerabilityData(parsedToSave)
  end
  #currently one test since this data is checked in yaml parsing tests
  test "fixes test correct data" do
    parsedToSave = {"CVE"=>"CVE-2011-3092", "bounty"=>"$1000.00", "announced"=>{"date"=>DateTime.new(2012,5,15), "url"=>"http://googlechromereleases.blogspot.com/2012/05/stable-channel-update.html"}, "code_reviews"=>[39004], "bugs"=>[122337], "fixes"=>["f3e8965444b0b615ed8aabfcacc5840f6684c0c5"], "vccs"=>[{"4bab3b214e92e0884af87c4ae9287da3daff5f3d"=>{"note"=>"The original logic didnt handle the crossplatform line endings when the original Webkit port was brought in. Yes, this is a vulnerability in a Makefile."}}, {"6fe4e841191055b69f5df33002e78d75bfdcf725"=>{"note"=>"They worked on the Windows encodings for this one. They also decided to upgrade Cygwin to fix this."}}]}
    assert fixesData(parsedToSave)
  end
  #check file and vccs data
  test "codeReviews correct data" do
    parsedToSave = {"CVE"=>"CVE-2011-3092", "bounty"=>"$1000.00", "announced"=>{"date"=>DateTime.new(2012,5,15), "url"=>"http://googlechromereleases.blogspot.com/2012/05/stable-channel-update.html"}, "code_reviews"=>[39004], "bugs"=>[122337], "fixes"=>["f3e8965444b0b615ed8aabfcacc5840f6684c0c5"], "vccs"=>[{"4bab3b214e92e0884af87c4ae9287da3daff5f3d"=>{"note"=>"The original logic didnt handle the crossplatform line endings when the original Webkit port was brought in. Yes, this is a vulnerability in a Makefile."}}, {"6fe4e841191055b69f5df33002e78d75bfdcf725"=>{"note"=>"They worked on the Windows encodings for this one. They also decided to upgrade Cygwin to fix this."}}]}
    assert codeReviewsData(parsedToSave)
  end
  #check file and vccs data no notes
  test "fixes correct data" do
    parsedToSave = {"CVE"=>"CVE-2011-3092", "bounty"=>"$1000.00", "announced"=>{"date"=>DateTime.new(2012,5,15), "url"=>"http://googlechromereleases.blogspot.com/2012/05/stable-channel-update.html"}, "code_reviews"=>[39004], "bugs"=>[122337], "fixes"=>["f3e8965444b0b615ed8aabfcacc5840f6684c0c5"], "vccs"=>[{"4bab3b214e92e0884af87c4ae9287da3daff5f3d"=>{"note"=>"The original logic didnt handle the crossplatform line endings when the original Webkit port was brought in. Yes, this is a vulnerability in a Makefile."}}, {"6fe4e841191055b69f5df33002e78d75bfdcf725"=>{"note"=>"They worked on the Windows encodings for this one. They also decided to upgrade Cygwin to fix this."}}]}
    assert fixesData(parsedToSave)
  end
  #check file and vccs data no notes
  test "bugs correct data" do
    parsedToSave = {"CVE"=>"CVE-2011-3092", "bounty"=>"$1000.00", "announced"=>{"date"=>DateTime.new(2012,5,15), "url"=>"http://googlechromereleases.blogspot.com/2012/05/stable-channel-update.html"}, "code_reviews"=>[39004], "bugs"=>[122337], "fixes"=>["f3e8965444b0b615ed8aabfcacc5840f6684c0c5"], "vccs"=>[{"4bab3b214e92e0884af87c4ae9287da3daff5f3d"=>{"note"=>"The original logic didnt handle the crossplatform line endings when the original Webkit port was brought in. Yes, this is a vulnerability in a Makefile."}}, {"6fe4e841191055b69f5df33002e78d75bfdcf725"=>{"note"=>"They worked on the Windows encodings for this one. They also decided to upgrade Cygwin to fix this."}}]}
    assert bugsData(parsedToSave)
  end
  #check vccs data correct input
  test "vccs test no notes and no vccs" do
    parsedToSave = {"CVE"=>"CVE-2011-3092", "bounty"=>"$1000.00", "announced"=>{"date"=>DateTime.new(2012,5,15), "url"=>"http://googlechromereleases.blogspot.com/2012/05/stable-channel-update.html"}, "code_reviews"=>[39004], "bugs"=>[122337], "fixes"=>["f3e8965444b0b615ed8aabfcacc5840f6684c0c5"], "vccs"=>[{"4bab3b214e92e0884af87c4ae9287da3daff5f3d"=>{"note"=>"The original logic didnt handle the crossplatform line endings when the original Webkit port was brought in. Yes, this is a vulnerability in a Makefile."}}, {"6fe4e841191055b69f5df33002e78d75bfdcf725"=>{"note"=>"They worked on the Windows encodings for this one. They also decided to upgrade Cygwin to fix this."}}]}
    assert vccsData(parsedToSave)
  end
  test "vccs test no notes" do
    parsedToSave = {"CVE"=>"CVE-2011-3092", "bounty"=>"$1000.00", "announced"=>{"date"=>DateTime.new(2012,5,15), "url"=>"http://googlechromereleases.blogspot.com/2012/05/stable-channel-update.html"}, "code_reviews"=>[39004], "bugs"=>[122337], "fixes"=>["f3e8965444b0b615ed8aabfcacc5840f6684c0c5"], "vccs"=>[{"4bab3b214e92e0884af87c4ae9287da3daff5f3d"=>{}}, {"6fe4e841191055b69f5df33002e78d75bfdcf725"=>{}}]}
    assert vccsData(parsedToSave)
  end
end