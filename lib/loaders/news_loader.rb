class NewsLoader
  def load_data(writing_dir)
		@logger = TimingLogger.new(STDOUT, 'data:writing:news')
		news_files = Dir["#{writing_dir}/news/*.md"].to_a
		@logger.info "Found #{news_files.size} news items..."

    news_files.each do |filename|
			begin
				desc = File.open(filename) {|f| f.read }
				NewsItem.create!(description: desc, posted: to_posted_date(filename))
			rescue => e
				@logger.warn("Exception loading news file: #{filename}. Skipping.")
        @logger.warn(e.full_message)
			end
		end
		@logger.info "Done."
  end

	def to_posted_date(filename)
		# YYYY-MM-DD. The only format the world can agree on.
		regex = %r{(?<date>\d\d\d\d\-\d\d\-\d\d)\.md$}
		return DateTime.parse(filename.match(regex)[:date])
	end

end
