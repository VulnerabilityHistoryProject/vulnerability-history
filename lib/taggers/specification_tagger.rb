require_relative '../writing'

class SpecificationTagger

  def initialize(project)
    @project = project
  end

  def create_tags
    @specification_tag = Tag.find_or_create_by!(
      name: 'Specification',
      shortname: 'specification',
      color: '#F0E68C',
      icon: 'specification',
      description: Writing.tag_article('specification')
    )
  end

  def apply_tags
    Vulnerability.where(project: @project).each do |v|
      if specification?(v)
        VulnerabilityTag.create!(
          vulnerability: v,
          tag: @specification_tag
        )
      end
    end
  end

  def specification?(v)
    specification = false
    if v.notes.dig('notes', 'specification', 'answer').present?
      specification = v.notes.dig('notes', 'specification', 'answer') == true
    end
    specification
  end
end