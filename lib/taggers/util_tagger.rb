require_relative '../writing'

class UtilTagger

  def initialize
  end

  def create_tags
    @util_tag = Tag.find_or_create_by!(
      name: 'Util',
      shortname: 'util',
      color: '#FF6700',
      icon: 'util',
      description: Writing.tag_article('util')
    )
  end

  def apply_tags
    Vulnerability.joins(fixes: {commit: :filepaths})
                 .where("filepath LIKE '%util%' AND filepaths.is_test = FALSE")
                 .distinct
                 .each do |v|
      # without this query there were duplicate tags being applied
      unless VulnerabilityTag.exists?(vulnerability_id: v.id, tag_id: @util_tag.id)
        VulnerabilityTag.create!(
          vulnerability: v,
          tag: @util_tag,
          importance: 0.25,
          )
      end
    end
  end


end