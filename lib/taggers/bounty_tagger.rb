class BountyTagger
  def create_tags
    @bounty_tag = Tag.create!(
      name: 'Bounty Awarded',
      shortname: 'bounty',
      color: '#32CD32',
      description: <<~EOS
        This tag is applied to all vulnerabilities that were awarded a bounty.
      EOS
    )
  end

  def apply_tags
    Vulnerability.all.each do |v|
      if has_bounty?(v)
        VulnerabilityTag.create!(
          vulnerability: v,
          tag: @bounty_tag,
          note: <<~EOS
            Bounty was awarded #{v.notes.dig('bounty', 'date').to_s}.
          EOS
        )
      end
    end
  end

  def has_bounty?(v)
    v.notes.dig('bounty', 'amount').to_i > 0
  end
end
