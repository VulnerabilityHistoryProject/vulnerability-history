class SubsystemTagger

  def create_tags
    Vulnerability.all.each do |v|
      name = v.notes.dig('subsystem', 'name')
      if (name)
        n = name.downcase
        @tag = Tag.find_by(shortname: n)
        if not @tag
          @tag = Tag.create!(
              name: n,
              shortname: n,
              color: '#cccccc',
              description: <<~EOS
            This tag is applied to all vulnerabilities that were discovered in the #{name} subsystem.
          EOS
          )
        end
      end
    end
  end

  def apply_tags
    Vulnerability.all.each do |v|
      name = v.notes.dig('subsystem', 'name')
      if (name)
        @t = Tag.find_by(shortname: name.downcase)
        VulnerabilityTag.create!(
                            vulnerability: v,
                            tag: @t,
                            note: <<~EOS
                              #{v.notes.dig('subsystem', 'answer').to_s.sub!("\n", ' ')}
                            EOS
        )
      end
    end
  end

end
