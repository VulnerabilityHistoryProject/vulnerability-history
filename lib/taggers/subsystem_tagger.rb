class SubsystemTagger
  def create_tags
    Vulnerability.all.each do |v|
      if v.notes.dig('subsystem', 'name') != nil
        sub_name = String.new(v.notes.dig('subsystem', 'name'))
        #todo: Sanitize string for xss! Actually probably applies to everything
        sub_name.downcase!
        if Tag.exists?(shortname: sub_name)
          @subsys_tag = Tag.find_by(shortname: sub_name)
        else
          @subsys_tag = Tag.create!(
              name: sub_name + ' subsystem',
              shortname: sub_name,
              color: "%06x" % (rand * 0xffffff),
              description: 'This tag is applied to all vulnerabilities under the ' + sub_name + 'subsystem.'
          )
        end
        VulnerabilityTag.create!(
            vulnerability: v,
            tag: @subsys_tag,
            note: v.notes.dig('subsystem', 'answer')
        )
      end
    end
  end
  def apply_tags

  end
end
