require_relative '../writing'
class DEPSTagger

  def initialize
  end

  def create_tags
    @DEPS_tag = Tag.find_or_create_by!(
      name: 'Dependency Issue',
      shortname: 'dependency',
      color: '#f5883d',
      icon: 'dependency',
      description: Writing.tag_article('dependency'),
      family: 'deps',
      tag_grouping: TagGrouping.find_by(slug: 'supply-chain')
    )
  end

  def apply_tags
    Vulnerability.joins([:project, fixes: {commit: :filepaths}])
                 .where("filepaths.filepath = 'DEPS'")
                 .each do |v|
      VulnerabilityTag.create!(
        vulnerability: v,
        importance: 0.15, #sorta important, but not really
        tag: @DEPS_tag
      )
    end
  end
end
