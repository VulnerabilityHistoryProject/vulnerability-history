require_relative '../writing'

class IPCTagger

  def initialize
  end

  def create_tags
    @tag = Tag.find_or_create_by!(
      name: 'Inter-Process Communication',
      shortname: 'ipc',
      color: '#2e5ef3',
      icon: 'ipc',
      description: Writing.tag_article('ipc'),
      family: 'ipc',
      tag_grouping: TagGrouping.find_by(slug: 'type'),
    )
  end

  def apply_tags
    Vulnerability.all.each do |v|
      if answer_correct(v)
        VulnerabilityTag.create!(
          vulnerability: v,
          tag: @tag
        )
      end
    end
  end

  def answer_correct(v)
    v.notes.dig('ipc', 'answer') == true # not nil or false
  end
end
