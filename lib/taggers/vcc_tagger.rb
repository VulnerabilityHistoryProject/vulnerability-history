require_relative '../writing'

class VCCTagger

  def initialize(project)
    @project = project
  end

  def create_tags
    @vcc_tag = Tag.find_or_create_by!(
        name: 'VCC',
        shortname: 'vcc',
        color: '#c686d9',
        icon: 'description',
        description: Writing.tag_article('vcc')
    )
  end

  def apply_tags
    Vulnerability.where(project: @project).each do |v|
      if has_vcc?(v)  # vcc present
        VulnerabilityTag.create!(
            vulnerability: v,
            tag: @vcc_tag,
            importance: 0.25,
            )
      end
    end
  end

  def has_vcc?(v)
    hasVcc = false
    v.notes.dig('vccs').each do |val| #loop through the vcc list
      hasVcc = val['note'].present? || val['commit'].present?
      if hasVcc
        break
      end
    end
    hasVcc
  end
end