class ProjectTagger

  def create_tags
    # not needed
    @tags = {}
    Project.all.each do |p|
      @tags[p.subdomain] = Tag.find_or_initialize_by(
        name: "Project: #{p.name}",
        shortname: "project-#{p.subdomain}",
        color: p.bg_color,
        description: <<~EOS
          This tag is applied to vulnerabilities reported in #{p.fullname}
        EOS
        family: 'project'
      )
    end
  end

  def apply_tags
    Vulnerability.joins(:project).each do |v|
      VulnerabilityTag.create!(
        vulnerability: v,
        tag: @tags[v.project.subdomain],
        note: ''
      )
    end

  end

end
