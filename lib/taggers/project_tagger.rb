class ProjectTagger

  def create_tags
    # not needed
    @tags = {}
    Project.all.each do |p|
      @tags[p.subdomain] = Tag.find_by(shortname: "project-#{p.subdomain}")
      @tags[p.subdomain] ||= Tag.create!(
        name: "Project: #{p.name}",
        shortname: "project-#{p.subdomain}",
        color: p.bg_color,
        family: 'project',
        tag_grouping: TagGrouping.find_by(slug: 'project'),
        description: <<~EOS
          This tag is applied to vulnerabilities reported in #{p.fullname}
        EOS
      )
    end
  end

  def apply_tags
    Vulnerability.joins(:project).each do |v|
      VulnerabilityTag.create!(
        vulnerability: v,
        tag: @tags[v.project.subdomain],
        note: ''
      )
    end

  end

end
