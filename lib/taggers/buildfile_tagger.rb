class BuildFileTagger

    def create_tags
      @buildfile_tag = Tag.find_or_initialize_by(
        name: 'Build File Modified',
        shortname: 'buildfile',
        color: '#f7f02e',
        description: <<~EOS
          We define a build file as any file that is used by a build system in order to track dependencies.
          This may be a Makefile, configure file, gyp file or others. 
        EOS
      )
      end
  
    end
  
    def apply_tags
      Vulnerability.all.each do |v|
        if is_buildfile?(v)
          VulnerabilityTag.create!(
            vulnerability: v,
            tag: @buildfile_tag,
            note: "VCCS for this vulnerability have modified the following build files: " + @buildFiles
          )
        end
      end
    end
  
    def is_buildfile?(v)
      @buildFiles = Array.new
      found_buildfile = false
      v.vccs.each do |vccs|
        vcc.commit.filepaths.each do |filepath|
        # @buildfile_types = [ 'Makefile*', 'configure.in', 'pom.xml', '*.gyp*' ]
          if filepath.matches?("*Makefile*")
            buildFiles.add(filepath)
          elsif filepath.matches?("*configure.in")
            buildFiles.add(filepath)
          elsif filepath.matches?("*.gyp*")
            buildFiles.add(filepath)
          elsif filepath.matches?("*.make")
            buildFiles.add(filepath)
          end
        end
      end
    end
  end
  