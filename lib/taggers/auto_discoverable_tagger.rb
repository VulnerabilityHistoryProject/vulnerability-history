require_relative '../writing'

class AutoDiscoverableTagger

  def initialize
  end

  def create_tags
    @auto_disc_tag = Tag.find_or_create_by!(
      name: 'Not Auto Discoverable',
      shortname: 'not-autodiscoverable',
      color: '#FF5733',
      icon: 'auto-disc',
      description: Writing.tag_article('not-autodiscoverable'),
      tag_grouping: TagGrouping.find_by(slug: 'discovery-methods')
    )
  end

  def apply_tags
    Vulnerability.all.each do |v|
      if auto_disc?(v)
        VulnerabilityTag.create!(
          vulnerability: v,
          tag: @auto_disc_tag
        )
      end
    end
  end

  def auto_disc?(v)
    auto_disc = false
    if v.notes.dig('autodiscoverable', 'answer').present?
      auto_disc = v.notes.dig('autodiscoverable', 'answer') == true
    end
    auto_disc
  end
end